import React, { useState, useEffect, useCallback } from 'react';

const ShootingGame = () => {
  const [score, setScore] = useState(0);
  const [bullets, setBullets] = useState(999); // å®Ÿè³ªç„¡åˆ¶é™
  const [timeLeft, setTimeLeft] = useState(60); // 60ç§’ã®åˆ¶é™æ™‚é–“
  const [targets, setTargets] = useState([]);
  const [items, setItems] = useState([]);
  const [gameActive, setGameActive] = useState(false);
  const [crosshair, setCrosshair] = useState({ x: 0, y: 0 });
  const [showCrosshair, setShowCrosshair] = useState(false);
  const [selectedLevel, setSelectedLevel] = useState('beginner');
  const [showLevelSelect, setShowLevelSelect] = useState(true);

  // ãƒ¬ãƒ™ãƒ«è¨­å®š
  const levelSettings = {
    beginner: {
      name: 'åˆç´š',
      emoji: 'ğŸŸ¢',
      description: 'ã‚†ã£ãã‚Šã¨å¤§ãã‚ã®çš„',
      targetInterval: 2500,
      maxTargets: 5,
      minSize: 60,
      maxSize: 100,
      timeLimit: 90, // 90ç§’
      targetLifetime: 4000,
      theme: {
        title: 'ğŸŒ³ æ£®ã®å°„çš„å ´',
        background: 'linear-gradient(to bottom, #87CEEB 0%, #98FB98 40%, #8FBC8F 70%, #228B22 100%)',
        groundColor: 'from-green-800 to-green-900',
        borderColor: 'border-amber-800',
        description: 'é™ã‹ãªæ£®ã§ã®ç·´ç¿’'
      }
    },
    intermediate: {
      name: 'ä¸­ç´š',
      emoji: 'ğŸŸ¡',
      description: 'æ¨™æº–çš„ãªé€Ÿåº¦ã¨ã‚µã‚¤ã‚º',
      targetInterval: 1500,
      maxTargets: 6,
      minSize: 40,
      maxSize: 80,
      timeLimit: 60, // 60ç§’
      targetLifetime: 3000,
      theme: {
        title: 'ğŸ™ï¸ éƒ½å¸‚ã®å°„çš„å ´',
        background: 'linear-gradient(to bottom, #FFB347 0%, #FF8C69 30%, #696969 60%, #2F4F4F 100%)',
        groundColor: 'from-gray-700 to-gray-900',
        borderColor: 'border-gray-600',
        description: 'éƒ½å¸‚ã®å±‹ä¸Šã§ã®è¨“ç·´'
      }
    },
    advanced: {
      name: 'ä¸Šç´š',
      emoji: 'ğŸ”´',
      description: 'é«˜é€Ÿã§å°ã•ãªçš„',
      targetInterval: 1000,
      maxTargets: 8,
      minSize: 25,
      maxSize: 60,
      timeLimit: 45, // 45ç§’
      targetLifetime: 2000,
      theme: {
        title: 'ğŸŒŒ å®‡å®™ã®å°„çš„å ´',
        background: 'linear-gradient(to bottom, #000428 0%, #004e92 30%, #0a0a0a 60%, #1a1a2e 100%)',
        groundColor: 'from-purple-900 to-black',
        borderColor: 'border-purple-500',
        description: 'å®‡å®™ã‚¹ãƒ†ãƒ¼ã‚·ãƒ§ãƒ³ã§ã®ç‰¹è¨“'
      }
    }
  };

  const currentLevel = levelSettings[selectedLevel];

  // ã‚¿ã‚¤ãƒãƒ¼ç®¡ç†
  useEffect(() => {
    if (!gameActive) return;

    const timer = setInterval(() => {
      setTimeLeft(prev => {
        if (prev <= 1) {
          setGameActive(false);
          setShowCrosshair(false);
          return 0;
        }
        return prev - 1;
      });
    }, 1000);

    return () => clearInterval(timer);
  }, [gameActive]);

  // åŠ¹æœéŸ³ã‚’å†ç”Ÿã™ã‚‹é–¢æ•°
  const playSound = (type) => {
    try {
      const audioContext = new (window.AudioContext || window.webkitAudioContext)();
      const oscillator = audioContext.createOscillator();
      const gainNode = audioContext.createGain();
      
      oscillator.connect(gainNode);
      gainNode.connect(audioContext.destination);
      
      if (type === 'hit') {
        // çš„å‘½ä¸­éŸ³ - é«˜ã„éŸ³ã‹ã‚‰ä½ã„éŸ³ã¸
        oscillator.frequency.setValueAtTime(800, audioContext.currentTime);
        oscillator.frequency.exponentialRampToValueAtTime(200, audioContext.currentTime + 0.3);
        gainNode.gain.setValueAtTime(0.3, audioContext.currentTime);
        gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.3);
        oscillator.type = 'triangle';
        oscillator.start();
        oscillator.stop(audioContext.currentTime + 0.3);
      } else if (type === 'moving') {
        // å‹•ãçš„å‘½ä¸­éŸ³ - è¯ã‚„ã‹ãªä¸Šæ˜‡éŸ³
        oscillator.frequency.setValueAtTime(400, audioContext.currentTime);
        oscillator.frequency.exponentialRampToValueAtTime(1200, audioContext.currentTime + 0.4);
        gainNode.gain.setValueAtTime(0.4, audioContext.currentTime);
        gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.4);
        oscillator.type = 'sine';
        oscillator.start();
        oscillator.stop(audioContext.currentTime + 0.4);
      } else if (type === 'negative') {
        // ãƒã‚¤ãƒŠã‚¹çš„å‘½ä¸­éŸ³ - ä¸å”å’ŒéŸ³
        oscillator.frequency.setValueAtTime(150, audioContext.currentTime);
        oscillator.frequency.setValueAtTime(140, audioContext.currentTime + 0.1);
        oscillator.frequency.setValueAtTime(130, audioContext.currentTime + 0.2);
        gainNode.gain.setValueAtTime(0.4, audioContext.currentTime);
        gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.4);
        oscillator.type = 'sawtooth';
        oscillator.start();
        oscillator.stop(audioContext.currentTime + 0.4);
      } else if (type === 'timeBomb') {
        // æ™‚é–“çˆ†å¼¾éŸ³ - çˆ†ç™ºéŸ³
        oscillator.frequency.setValueAtTime(100, audioContext.currentTime);
        oscillator.frequency.exponentialRampToValueAtTime(50, audioContext.currentTime + 0.5);
        gainNode.gain.setValueAtTime(0.5, audioContext.currentTime);
        gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.5);
        oscillator.type = 'square';
        oscillator.start();
        oscillator.stop(audioContext.currentTime + 0.5);
      } else if (type === 'item') {
        // ã‚¢ã‚¤ãƒ†ãƒ å–å¾—éŸ³ - ã‚­ãƒ©ã‚­ãƒ©éŸ³
        oscillator.frequency.setValueAtTime(600, audioContext.currentTime);
        oscillator.frequency.setValueAtTime(800, audioContext.currentTime + 0.1);
        oscillator.frequency.setValueAtTime(1000, audioContext.currentTime + 0.2);
        gainNode.gain.setValueAtTime(0.2, audioContext.currentTime);
        gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.3);
        oscillator.type = 'sine';
        oscillator.start();
        oscillator.stop(audioContext.currentTime + 0.3);
      }
    } catch (error) {
      // åŠ¹æœéŸ³ãŒå†ç”Ÿã§ããªã„å ´åˆã¯ç„¡è¦–
      console.log('Audio not supported');
    }
  };

  // çˆ†ç™ºã‚¨ãƒ•ã‚§ã‚¯ãƒˆã‚’ä½œæˆã™ã‚‹é–¢æ•°
  const createExplosion = (x, y, gameArea, type = 'normal') => {
    if (type === 'negative') {
      // ãƒã‚¤ãƒŠã‚¹çš„ç”¨ã®æš—ã„ã‚¨ãƒ•ã‚§ã‚¯ãƒˆ
      const explosion = document.createElement('div');
      explosion.style.position = 'absolute';
      explosion.style.left = (x - 25) + 'px';
      explosion.style.top = (y - 25) + 'px';
      explosion.style.width = '50px';
      explosion.style.height = '50px';
      explosion.style.background = 'radial-gradient(circle, #8B0000 0%, #4B0000 30%, #2B0000 60%, transparent 100%)';
      explosion.style.borderRadius = '50%';
      explosion.style.pointerEvents = 'none';
      explosion.style.zIndex = '999';
      explosion.className = 'explosion';
      gameArea.appendChild(explosion);

      // æš—ã„ç«èŠ±ã‚¨ãƒ•ã‚§ã‚¯ãƒˆ
      for (let i = 0; i < 6; i++) {
        const spark = document.createElement('div');
        const angle = (i / 6) * Math.PI * 2;
        const distance = 25 + Math.random() * 15;
        const sparkX = x + Math.cos(angle) * distance;
        const sparkY = y + Math.sin(angle) * distance;
        
        spark.style.position = 'absolute';
        spark.style.left = sparkX + 'px';
        spark.style.top = sparkY + 'px';
        spark.style.width = '4px';
        spark.style.height = '4px';
        spark.style.background = ['#8B0000', '#4B0000', '#2B0000'][Math.floor(Math.random() * 3)];
        spark.style.borderRadius = '50%';
        spark.style.pointerEvents = 'none';
        spark.style.zIndex = '998';
        spark.className = 'sparkle';
        spark.style.animationDelay = (Math.random() * 0.2) + 's';
        gameArea.appendChild(spark);
        
        setTimeout(() => {
          if (spark.parentNode) {
            spark.parentNode.removeChild(spark);
          }
        }, 800);
      }

      setTimeout(() => {
        if (explosion.parentNode) {
          explosion.parentNode.removeChild(explosion);
        }
      }, 600);
    } else if (type === 'moving') {
      // å‹•ãçš„ç”¨ã®è±ªè¯ãªã‚ªãƒ¬ãƒ³ã‚¸ã‚¨ãƒ•ã‚§ã‚¯ãƒˆ
      const explosion = document.createElement('div');
      explosion.style.position = 'absolute';
      explosion.style.left = (x - 35) + 'px';
      explosion.style.top = (y - 35) + 'px';
      explosion.style.width = '70px';
      explosion.style.height = '70px';
      explosion.style.background = 'radial-gradient(circle, #FFD700 0%, #FF6B35 30%, #FF4500 60%, transparent 100%)';
      explosion.style.borderRadius = '50%';
      explosion.style.pointerEvents = 'none';
      explosion.style.zIndex = '999';
      explosion.className = 'explosion';
      explosion.style.boxShadow = '0 0 30px #FF6B35';
      gameArea.appendChild(explosion);

      // è±ªè¯ãªã‚ªãƒ¬ãƒ³ã‚¸ç«èŠ±ã‚¨ãƒ•ã‚§ã‚¯ãƒˆ
      for (let i = 0; i < 12; i++) {
        const spark = document.createElement('div');
        const angle = (i / 12) * Math.PI * 2;
        const distance = 40 + Math.random() * 30;
        const sparkX = x + Math.cos(angle) * distance;
        const sparkY = y + Math.sin(angle) * distance;
        
        spark.style.position = 'absolute';
        spark.style.left = sparkX + 'px';
        spark.style.top = sparkY + 'px';
        spark.style.width = '8px';
        spark.style.height = '8px';
        spark.style.background = ['#FFD700', '#FF6B35', '#FF4500', '#FFA500'][Math.floor(Math.random() * 4)];
        spark.style.borderRadius = '50%';
        spark.style.pointerEvents = 'none';
        spark.style.zIndex = '998';
        spark.style.boxShadow = `0 0 10px ${spark.style.background}`;
        spark.className = 'sparkle';
        spark.style.animationDelay = (Math.random() * 0.3) + 's';
        gameArea.appendChild(spark);
        
        setTimeout(() => {
          if (spark.parentNode) {
            spark.parentNode.removeChild(spark);
          }
        }, 1200);
      }

      setTimeout(() => {
        if (explosion.parentNode) {
          explosion.parentNode.removeChild(explosion);
        }
      }, 800);
    } else if (type === 'timeBomb') {
      // æ™‚é–“çˆ†å¼¾ç”¨ã®ç´«ã®ã‚¨ãƒ•ã‚§ã‚¯ãƒˆ
      const explosion = document.createElement('div');
      explosion.style.position = 'absolute';
      explosion.style.left = (x - 30) + 'px';
      explosion.style.top = (y - 30) + 'px';
      explosion.style.width = '60px';
      explosion.style.height = '60px';
      explosion.style.background = 'radial-gradient(circle, #4B0082 0%, #2F004F 30%, #1A002E 60%, transparent 100%)';
      explosion.style.borderRadius = '50%';
      explosion.style.pointerEvents = 'none';
      explosion.style.zIndex = '999';
      explosion.className = 'explosion';
      gameArea.appendChild(explosion);

      // ç´«ã®ç«èŠ±ã‚¨ãƒ•ã‚§ã‚¯ãƒˆ
      for (let i = 0; i < 10; i++) {
        const spark = document.createElement('div');
        const angle = (i / 10) * Math.PI * 2;
        const distance = 35 + Math.random() * 25;
        const sparkX = x + Math.cos(angle) * distance;
        const sparkY = y + Math.sin(angle) * distance;
        
        spark.style.position = 'absolute';
        spark.style.left = sparkX + 'px';
        spark.style.top = sparkY + 'px';
        spark.style.width = '8px';
        spark.style.height = '8px';
        spark.style.background = ['#4B0082', '#8A2BE2', '#9932CC', '#6A0DAD'][Math.floor(Math.random() * 4)];
        spark.style.borderRadius = '50%';
        spark.style.pointerEvents = 'none';
        spark.style.zIndex = '998';
        spark.className = 'sparkle';
        spark.style.animationDelay = (Math.random() * 0.3) + 's';
        gameArea.appendChild(spark);
        
        setTimeout(() => {
          if (spark.parentNode) {
            spark.parentNode.removeChild(spark);
          }
        }, 1000);
      }

      setTimeout(() => {
        if (explosion.parentNode) {
          explosion.parentNode.removeChild(explosion);
        }
      }, 600);
    } else {
      // é€šå¸¸ã®çˆ†ç™ºã‚¨ãƒ•ã‚§ã‚¯ãƒˆ
      const explosion = document.createElement('div');
      explosion.style.position = 'absolute';
      explosion.style.left = (x - 25) + 'px';
      explosion.style.top = (y - 25) + 'px';
      explosion.style.width = '50px';
      explosion.style.height = '50px';
      explosion.style.background = 'radial-gradient(circle, #ffff00 0%, #ff8c00 30%, #ff4500 60%, transparent 100%)';
      explosion.style.borderRadius = '50%';
      explosion.style.pointerEvents = 'none';
      explosion.style.zIndex = '999';
      explosion.className = 'explosion';
      gameArea.appendChild(explosion);

      // ç«èŠ±ã‚¨ãƒ•ã‚§ã‚¯ãƒˆ
      for (let i = 0; i < 8; i++) {
        const spark = document.createElement('div');
        const angle = (i / 8) * Math.PI * 2;
        const distance = 30 + Math.random() * 20;
        const sparkX = x + Math.cos(angle) * distance;
        const sparkY = y + Math.sin(angle) * distance;
        
        spark.style.position = 'absolute';
        spark.style.left = sparkX + 'px';
        spark.style.top = sparkY + 'px';
        spark.style.width = '6px';
        spark.style.height = '6px';
        spark.style.background = ['#ffff00', '#ff8c00', '#ff4500', '#ff1493'][Math.floor(Math.random() * 4)];
        spark.style.borderRadius = '50%';
        spark.style.pointerEvents = 'none';
        spark.style.zIndex = '998';
        spark.className = 'sparkle';
        spark.style.animationDelay = (Math.random() * 0.2) + 's';
        gameArea.appendChild(spark);
        
        setTimeout(() => {
          if (spark.parentNode) {
            spark.parentNode.removeChild(spark);
          }
        }, 800);
      }

      setTimeout(() => {
        if (explosion.parentNode) {
          explosion.parentNode.removeChild(explosion);
        }
      }, 600);
    }
  };

  // ã‚¢ã‚¤ãƒ†ãƒ ã‚’ç”Ÿæˆã™ã‚‹é–¢æ•°
  const createItem = () => {
    const gameArea = document.getElementById('game-area');
    if (!gameArea) return null;
    
    const rect = gameArea.getBoundingClientRect();
    const size = 30; // ã‚¢ã‚¤ãƒ†ãƒ ã®ã‚µã‚¤ã‚ºã¯å›ºå®š
    const x = Math.random() * (rect.width - size);
    const y = Math.random() * (rect.height - size);
    
    // ã‚¿ã‚¤ãƒ ã‚¢ã‚¿ãƒƒã‚¯ç”¨ã®ã‚¢ã‚¤ãƒ†ãƒ 
    const itemTypes = [
      { type: 'timeBonus', emoji: 'â°', timeBonus: 10, color: '#FF9800', name: 'æ™‚é–“å»¶é•·' },
      { type: 'scoreBonus', emoji: 'â­', scoreBonus: 50, color: '#FFD700', name: 'ã‚¹ã‚³ã‚¢ãƒœãƒ¼ãƒŠã‚¹' },
      { type: 'multiShot', emoji: 'ğŸ†', scoreMultiplier: 2, duration: 5000, color: '#E91E63', name: '2å€ã‚¹ã‚³ã‚¢' }
    ];
    
    const itemType = itemTypes[Math.floor(Math.random() * itemTypes.length)];
    
    return {
      id: Date.now() + Math.random(),
      x,
      y,
      size,
      createdAt: Date.now(),
      ...itemType
    };
  };

  // ã‚¢ã‚¤ãƒ†ãƒ ã‚’å®šæœŸçš„ã«ç”Ÿæˆ
  useEffect(() => {
    if (!gameActive) return;

    const interval = setInterval(() => {
      // 20%ã®ç¢ºç‡ã§ã‚¢ã‚¤ãƒ†ãƒ ç”Ÿæˆ
      if (Math.random() < 0.2) {
        const newItem = createItem();
        if (newItem) {
          setItems(prev => [...prev, newItem]);
        }
      }
    }, 3000); // 3ç§’ã”ã¨ã«ãƒã‚§ãƒƒã‚¯

    return () => clearInterval(interval);
  }, [gameActive]);

  // å¤ã„ã‚¢ã‚¤ãƒ†ãƒ ã‚’å‰Šé™¤
  useEffect(() => {
    if (!gameActive) return;

    const cleanup = setInterval(() => {
      const now = Date.now();
      setItems(prev => prev.filter(item => 
        (now - item.createdAt < 8000) // 8ç§’ã§æ¶ˆå¤±
      ));
    }, 1000);

    return () => clearInterval(cleanup);
  }, [gameActive]);

  // çš„ã‚’ç”Ÿæˆã™ã‚‹é–¢æ•°
  const createTarget = () => {
    const gameArea = document.getElementById('game-area');
    if (!gameArea) return null;
    
    const rect = gameArea.getBoundingClientRect();
    const sizeRange = currentLevel.maxSize - currentLevel.minSize;
    const size = Math.random() * sizeRange + currentLevel.minSize;
    const x = Math.random() * (rect.width - size);
    const y = Math.random() * (rect.height - size);
    
    const random = Math.random();
    
    if (random < 0.15) {
      // 15%ã®ç¢ºç‡ã§å‹•ãçš„ã‚’ç”Ÿæˆï¼ˆç¢ºç‡ã‚’ã•ã‚‰ã«ä¸Šã’ã¦å‹•ãã‚’ç¢ºèªã—ã‚„ã™ãï¼‰
      const movementTypes = ['vertical', 'horizontal', 'circular', 'zigzag']; // verticalã‚’æœ€åˆã«
      const movementType = movementTypes[Math.floor(Math.random() * movementTypes.length)];
      
      // åˆæœŸæ–¹å‘ã‚’æ˜ç¢ºã«è¨­å®š
      let initialDirection;
      switch (movementType) {
        case 'horizontal':
          initialDirection = Math.random() > 0.5 ? 1 : -1; // å³å‘ã(1)ã¾ãŸã¯å·¦å‘ã(-1)
          break;
        case 'vertical':
          initialDirection = Math.random() > 0.5 ? 1 : -1; // ä¸‹å‘ã(1)ã¾ãŸã¯ä¸Šå‘ã(-1)
          break;
        case 'circular':
          initialDirection = 0; // å††é‹å‹•ã§ã¯ä½¿ã‚ãªã„
          break;
        case 'zigzag':
          initialDirection = Math.random() * Math.PI * 2; // ãƒ©ãƒ³ãƒ€ãƒ æ–¹å‘
          break;
        default:
          initialDirection = 1;
      }
      
      return {
        id: Date.now() + Math.random(),
        x,
        y,
        size,
        points: Math.floor(200 / (size / 10)) + 150, // å‹•ãçš„ã¯è¶…é«˜å¾—ç‚¹
        color: '#FF6B35', // ã‚ªãƒ¬ãƒ³ã‚¸è‰²
        createdAt: Date.now(),
        isMoving: true,
        movementType,
        speed: 3 + Math.random() * 4, // 3-7ã®é«˜é€Ÿåº¦
        direction: initialDirection,
        centerX: x + size/2,
        centerY: y + size/2,
        radius: 50 + Math.random() * 70 // å††é‹å‹•ç”¨ã®åŠå¾„
      };
    } else if (random < 0.20) {
      // 5%ã®ç¢ºç‡ã§æ™‚é–“æ¸›å°‘çš„ã‚’ç”Ÿæˆ
      return {
        id: Date.now() + Math.random(),
        x,
        y,
        size,
        points: 0, // ãƒã‚¤ãƒ³ãƒˆãªã—
        timePenalty: Math.floor(5 + Math.random() * 10), // 5-15ç§’æ¸›å°‘
        color: '#4B0082', // ã‚¤ãƒ³ãƒ‡ã‚£ã‚´
        createdAt: Date.now(),
        isTimeBomb: true
      };
    } else if (random < 0.30) {
      // 10%ã®ç¢ºç‡ã§ãƒã‚¤ãƒŠã‚¹çš„ã‚’ç”Ÿæˆï¼ˆå…ƒã®10%ã‚’ç¶­æŒï¼‰
      return {
        id: Date.now() + Math.random(),
        x,
        y,
        size,
        points: -Math.floor(50 + (size / 2)), // ãƒã‚¤ãƒŠã‚¹ãƒã‚¤ãƒ³ãƒˆï¼ˆå¤§ãã„çš„ã»ã©å¤§ããªãƒã‚¤ãƒŠã‚¹ï¼‰
        color: '#8B0000', // ãƒ€ãƒ¼ã‚¯ãƒ¬ãƒƒãƒ‰
        createdAt: Date.now(),
        isNegative: true
      };
    } else {
      // é€šå¸¸ã®çš„
      return {
        id: Date.now() + Math.random(),
        x,
        y,
        size,
        points: Math.floor(150 / (size / 10)), // å°ã•ã„çš„ã»ã©é«˜å¾—ç‚¹ã€ãƒ¬ãƒ™ãƒ«ã«å¿œã˜ã¦èª¿æ•´
        color: `hsl(${Math.random() * 360}, 70%, 50%)`,
        createdAt: Date.now(),
        isNegative: false
      };
    }
  };

  // çš„ã‚’å®šæœŸçš„ã«ç”Ÿæˆ
  useEffect(() => {
    if (!gameActive) return;

    const interval = setInterval(() => {
      const newTarget = createTarget();
      if (newTarget) {
        setTargets(prev => [...prev, newTarget]);
      }
    }, currentLevel.targetInterval);

    return () => clearInterval(interval);
  }, [gameActive, selectedLevel]);

  // å¤ã„çš„ã‚’å‰Šé™¤ï¼ˆãƒ¬ãƒ™ãƒ«ã«å¿œã˜ãŸç”Ÿå­˜æ™‚é–“ï¼‰
  useEffect(() => {
    if (!gameActive) return;

    const cleanup = setInterval(() => {
      const now = Date.now();
      setTargets(prev => prev.filter(target => 
        (now - target.createdAt < currentLevel.targetLifetime) && 
        prev.indexOf(target) < currentLevel.maxTargets
      ));
    }, 500);

    return () => clearInterval(cleanup);
  }, [gameActive, selectedLevel]);

  // å‹•ãçš„ã®ä½ç½®ã‚’æ›´æ–°
  useEffect(() => {
    if (!gameActive) return;

    const moveTargets = setInterval(() => {
      const gameArea = document.getElementById('game-area');
      if (!gameArea) return;
      
      const rect = gameArea.getBoundingClientRect();
      
      setTargets(prev => prev.map(target => {
        if (!target.isMoving) return target;
        
        const now = Date.now();
        const elapsed = (now - target.createdAt) / 1000; // çµŒéæ™‚é–“ï¼ˆç§’ï¼‰
        
        let newX = target.x;
        let newY = target.y;
        let newDirection = target.direction;
        let newSpeed = target.speed;
        
        switch (target.movementType) {
          case 'horizontal':
            // å·¦å³ã«ç§»å‹•
            newX = target.x + (newDirection > 0 ? newSpeed * 4 : -newSpeed * 4);
            // ç«¯ã«åˆ°é”ã—ãŸã‚‰åè»¢
            if (newX <= 0) {
              newX = 0;
              newDirection = 1; // å³å‘ã
            } else if (newX >= rect.width - target.size) {
              newX = rect.width - target.size;
              newDirection = -1; // å·¦å‘ã
            }
            break;
            
          case 'vertical':
            // ä¸Šä¸‹ã«ç§»å‹•
            newY = target.y + (newDirection > 0 ? newSpeed * 4 : -newSpeed * 4);
            // ç«¯ã«åˆ°é”ã—ãŸã‚‰åè»¢
            if (newY <= 0) {
              newY = 0;
              newDirection = 1; // ä¸‹å‘ã
            } else if (newY >= rect.height - target.size) {
              newY = rect.height - target.size;
              newDirection = -1; // ä¸Šå‘ã
            }
            break;
            
          case 'circular':
            const angle = elapsed * newSpeed * 0.8;
            newX = target.centerX + Math.cos(angle) * target.radius - target.size/2;
            newY = target.centerY + Math.sin(angle) * target.radius - target.size/2;
            
            // å¢ƒç•Œãƒã‚§ãƒƒã‚¯ã—ã¦ä¸­å¿ƒä½ç½®ã‚’èª¿æ•´
            if (newX < 0) {
              target.centerX = target.radius + 10;
            } else if (newX > rect.width - target.size) {
              target.centerX = rect.width - target.radius - 10;
            }
            
            if (newY < 0) {
              target.centerY = target.radius + 10;
            } else if (newY > rect.height - target.size) {
              target.centerY = rect.height - target.radius - 10;
            }
            
            // å†è¨ˆç®—
            newX = target.centerX + Math.cos(angle) * target.radius - target.size/2;
            newY = target.centerY + Math.sin(angle) * target.radius - target.size/2;
            break;
            
          case 'zigzag':
            const zigzagAngle = elapsed * 4; // ã‚¸ã‚°ã‚¶ã‚°ã®é »åº¦
            newX = target.x + Math.cos(target.direction) * newSpeed * 2;
            newY = target.y + Math.sin(target.direction + Math.sin(zigzagAngle) * 1.5) * newSpeed * 2;
            
            // ç«¯ã«åˆ°é”ã—ãŸã‚‰æ–¹å‘å¤‰æ›´
            if (newX <= 0 || newX >= rect.width - target.size || 
                newY <= 0 || newY >= rect.height - target.size) {
              newDirection = Math.random() * Math.PI * 2; // å®Œå…¨ã«ãƒ©ãƒ³ãƒ€ãƒ ãªæ–°æ–¹å‘
            }
            break;
        }
        
        // å¢ƒç•Œå†…ã«å¼·åˆ¶çš„ã«åã‚ã‚‹
        newX = Math.max(0, Math.min(rect.width - target.size, newX));
        newY = Math.max(0, Math.min(rect.height - target.size, newY));
        
        return {
          ...target,
          x: newX,
          y: newY,
          direction: newDirection,
          speed: newSpeed
        };
      }));
    }, 16); // 60FPSã§æ›´æ–°ï¼ˆã•ã‚‰ã«æ»‘ã‚‰ã‹ï¼‰

    return () => clearInterval(moveTargets);
  }, [gameActive]);

  // ãƒã‚¦ã‚¹ã®å‹•ãã‚’è¿½è·¡
  const handleMouseMove = useCallback((e) => {
    if (!gameActive) return;
    
    const gameArea = document.getElementById('game-area');
    if (!gameArea) return;
    
    const rect = gameArea.getBoundingClientRect();
    setCrosshair({
      x: e.clientX - rect.left,
      y: e.clientY - rect.top
    });
  }, [gameActive]);

  // ã‚²ãƒ¼ãƒ ã‚¨ãƒªã‚¢ã«ãƒã‚¦ã‚¹ãŒå…¥ã£ãŸæ™‚
  const handleMouseEnter = () => {
    if (gameActive) {
      setShowCrosshair(true);
    }
  };

  // ã‚²ãƒ¼ãƒ ã‚¨ãƒªã‚¢ã‹ã‚‰ãƒã‚¦ã‚¹ãŒå‡ºãŸæ™‚
  const handleMouseLeave = () => {
    setShowCrosshair(false);
  };

  // ã‚¯ãƒªãƒƒã‚¯ã§å°„æ’ƒ
  const handleShoot = (e) => {
    if (!gameActive) return;

    const gameArea = document.getElementById('game-area');
    if (!gameArea) return;

    const rect = gameArea.getBoundingClientRect();
    const clickX = e.clientX - rect.left;
    const clickY = e.clientY - rect.top;

    let hit = false;
    let itemHit = false;

    // ã‚¢ã‚¤ãƒ†ãƒ ã«å½“ãŸã£ãŸã‹ãƒã‚§ãƒƒã‚¯
    setItems(prev => {
      return prev.filter(item => {
        const distance = Math.sqrt(
          Math.pow(clickX - (item.x + item.size/2), 2) + 
          Math.pow(clickY - (item.y + item.size/2), 2)
        );
        
        if (distance <= item.size/2) {
          // ã‚¢ã‚¤ãƒ†ãƒ åŠ¹æœã‚’é©ç”¨
          if (item.type === 'timeBonus') {
            setTimeLeft(prevTime => prevTime + item.timeBonus);
          } else if (item.type === 'scoreBonus') {
            setScore(prevScore => prevScore + item.scoreBonus);
          } else if (item.type === 'multiShot') {
            // ãƒãƒ«ãƒãƒ—ãƒ©ã‚¤ãƒ¤ãƒ¼åŠ¹æœï¼ˆç°¡å˜ãªå®Ÿè£…ï¼‰
            setScore(prevScore => prevScore + 100);
          }
          
          // ã‚¢ã‚¤ãƒ†ãƒ å–å¾—éŸ³ã‚’å†ç”Ÿ
          playSound('item');
          
          itemHit = true;
          
          // ã‚¢ã‚¤ãƒ†ãƒ å–å¾—ã‚¨ãƒ•ã‚§ã‚¯ãƒˆ
          const itemEffect = document.createElement('div');
          if (item.type === 'timeBonus') {
            itemEffect.innerHTML = `+${item.timeBonus}ç§’`;
          } else if (item.type === 'scoreBonus') {
            itemEffect.innerHTML = `+${item.scoreBonus}ç‚¹`;
          } else {
            itemEffect.innerHTML = '2å€ã‚¹ã‚³ã‚¢!';
          }
          itemEffect.style.position = 'absolute';
          itemEffect.style.left = (clickX - 30) + 'px';
          itemEffect.style.top = (clickY - 10) + 'px';
          itemEffect.style.color = item.color;
          itemEffect.style.fontWeight = 'bold';
          itemEffect.style.fontSize = '16px';
          itemEffect.style.pointerEvents = 'none';
          itemEffect.style.zIndex = '1000';
          itemEffect.style.animation = 'fadeUp 1s ease-out forwards';
          gameArea.appendChild(itemEffect);
          
          setTimeout(() => {
            if (itemEffect.parentNode) {
              itemEffect.parentNode.removeChild(itemEffect);
            }
          }, 1000);
          
          return false; // ã‚¢ã‚¤ãƒ†ãƒ ã‚’å‰Šé™¤
        }
        return true;
      });
    });

    // çš„ã«å½“ãŸã£ãŸã‹ãƒã‚§ãƒƒã‚¯ï¼ˆã‚¢ã‚¤ãƒ†ãƒ ã«å½“ãŸã£ã¦ã„ãªã„å ´åˆã®ã¿ï¼‰
    if (!itemHit) {
      setTargets(prev => {
        return prev.filter(target => {
          const distance = Math.sqrt(
            Math.pow(clickX - (target.x + target.size/2), 2) + 
            Math.pow(clickY - (target.y + target.size/2), 2)
          );
          
          if (distance <= target.size/2) {
            // çš„ã®ç¨®é¡ã«å¿œã˜ã¦å‡¦ç†ã‚’åˆ†ã‘ã‚‹
            if (target.isTimeBomb) {
              // æ™‚é–“æ¸›å°‘çš„ã®å‡¦ç†
              setTimeLeft(prevTime => Math.max(0, prevTime - target.timePenalty));
              createExplosion(target.x + target.size/2, target.y + target.size/2, gameArea, 'timeBomb');
              playSound('timeBomb');
              
              // æ™‚é–“æ¸›å°‘ã‚¨ãƒ•ã‚§ã‚¯ãƒˆ
              const timeEffect = document.createElement('div');
              timeEffect.innerHTML = `-${target.timePenalty}ç§’`;
              timeEffect.style.position = 'absolute';
              timeEffect.style.left = (clickX - 30) + 'px';
              timeEffect.style.top = (clickY - 10) + 'px';
              timeEffect.style.color = '#4B0082';
              timeEffect.style.fontWeight = 'bold';
              timeEffect.style.fontSize = '18px';
              timeEffect.style.pointerEvents = 'none';
              timeEffect.style.zIndex = '1000';
              timeEffect.style.animation = 'fadeUp 1.5s ease-out forwards';
              gameArea.appendChild(timeEffect);
              
              setTimeout(() => {
                if (timeEffect.parentNode) {
                  timeEffect.parentNode.removeChild(timeEffect);
                }
              }, 1500);
            } else {
              // é€šå¸¸ã®çš„ã¾ãŸã¯ãƒã‚¤ãƒŠã‚¹çš„ã®å‡¦ç†
              let finalPoints = target.points;
              
              // å‹•ãçš„ãªã‚‰ç‚¹æ•°ã‚’2å€ã«ï¼
              if (target.isMoving) {
                finalPoints = target.points * 2;
                
                // 2å€å¾—ç‚¹ã‚¨ãƒ•ã‚§ã‚¯ãƒˆ
                const doubleEffect = document.createElement('div');
                doubleEffect.innerHTML = `2å€! +${finalPoints}ç‚¹`;
                doubleEffect.style.position = 'absolute';
                doubleEffect.style.left = (clickX - 40) + 'px';
                doubleEffect.style.top = (clickY - 20) + 'px';
                doubleEffect.style.color = '#FF6B35';
                doubleEffect.style.fontWeight = 'bold';
                doubleEffect.style.fontSize = '20px';
                doubleEffect.style.textShadow = '2px 2px 4px rgba(0,0,0,0.5)';
                doubleEffect.style.pointerEvents = 'none';
                doubleEffect.style.zIndex = '1000';
                doubleEffect.style.animation = 'fadeUp 2s ease-out forwards';
                gameArea.appendChild(doubleEffect);
                
                setTimeout(() => {
                  if (doubleEffect.parentNode) {
                    doubleEffect.parentNode.removeChild(doubleEffect);
                  }
                }, 2000);
              }
              
              setScore(prevScore => prevScore + finalPoints);
              
              // çˆ†ç™ºã‚¨ãƒ•ã‚§ã‚¯ãƒˆã¨åŠ¹æœéŸ³ï¼ˆãƒã‚¤ãƒŠã‚¹çš„ã‹ã©ã†ã‹ã§åˆ†ã‘ã‚‹ï¼‰
              createExplosion(target.x + target.size/2, target.y + target.size/2, gameArea, target.isNegative ? 'negative' : target.isMoving ? 'moving' : 'normal');
              playSound(target.isNegative ? 'negative' : target.isMoving ? 'moving' : 'hit');
            }
            
            hit = true;
            return false; // çš„ã‚’å‰Šé™¤
          }
          return true;
        });
      });
    }

    // å½“ãŸã£ãŸæ™‚ã®åŸºæœ¬çš„ãªè¦–è¦šåŠ¹æœï¼ˆçˆ†ç™ºã‚¨ãƒ•ã‚§ã‚¯ãƒˆã«åŠ ãˆã¦ï¼‰
    if (hit || itemHit) {
      const hitEffect = document.createElement('div');
      hitEffect.style.position = 'absolute';
      hitEffect.style.left = clickX + 'px';
      hitEffect.style.top = clickY + 'px';
      hitEffect.style.width = '10px';
      hitEffect.style.height = '10px';
      hitEffect.style.background = itemHit ? '#4CAF50' : '#FFD700';
      hitEffect.style.borderRadius = '50%';
      hitEffect.style.pointerEvents = 'none';
      hitEffect.style.zIndex = '1000';
      hitEffect.style.boxShadow = `0 0 10px ${itemHit ? '#4CAF50' : '#FFD700'}`;
      gameArea.appendChild(hitEffect);
      
      setTimeout(() => {
        if (hitEffect.parentNode) {
          hitEffect.parentNode.removeChild(hitEffect);
        }
      }, 200);
    }
  };

  // ã‚²ãƒ¼ãƒ é–‹å§‹
  const startGame = () => {
    setGameActive(true);
    setScore(0);
    setBullets(999); // å®Ÿè³ªç„¡åˆ¶é™
    setTimeLeft(currentLevel.timeLimit);
    setTargets([]);
    setItems([]);
    setShowLevelSelect(false);
  };

  // ã‚²ãƒ¼ãƒ çµ‚äº†
  const endGame = () => {
    setGameActive(false);
    setShowCrosshair(false);
    setTargets([]);
    setItems([]);
    setShowLevelSelect(true);
  };

  // ãƒ¬ãƒ™ãƒ«é¸æŠ
  const selectLevel = (level) => {
    setSelectedLevel(level);
  };

  // æ™‚é–“åˆ‡ã‚Œã§ã‚²ãƒ¼ãƒ çµ‚äº†ã®å‡¦ç†
  useEffect(() => {
    if (gameActive && timeLeft <= 0) {
      setTimeout(() => {
        setGameActive(false);
        setShowCrosshair(false);
      }, 100);
    }
  }, [timeLeft, gameActive]);

  return (
    <div className="flex flex-col items-center min-h-screen bg-gradient-to-b from-blue-900 to-blue-600 p-4">
      <style>{`
        @keyframes fadeUp {
          0% { opacity: 1; transform: translateY(0); }
          100% { opacity: 0; transform: translateY(-30px); }
        }
        @keyframes explode {
          0% { transform: scale(0) rotate(0deg); opacity: 1; }
          50% { transform: scale(1.5) rotate(180deg); opacity: 0.8; }
          100% { transform: scale(2) rotate(360deg); opacity: 0; }
        }
        @keyframes sparkle {
          0% { transform: scale(0); opacity: 1; }
          50% { transform: scale(1); opacity: 1; }
          100% { transform: scale(0); opacity: 0; }
        }
        .explosion {
          animation: explode 0.6s ease-out forwards;
        }
        .sparkle {
          animation: sparkle 0.8s ease-out forwards;
        }
      `}</style>
      <div className="bg-white rounded-lg shadow-lg p-6 mb-4 w-full max-w-4xl">
        <h1 className="text-3xl font-bold text-center text-gray-800 mb-4">ğŸ¯ å°„çš„ã‚²ãƒ¼ãƒ </h1>
        
        {/* ã‚¹ã‚³ã‚¢ã¨æƒ…å ±è¡¨ç¤º */}
        <div className="flex justify-between items-center mb-4 text-lg font-semibold">
          <div className="text-blue-600">ã‚¹ã‚³ã‚¢: {score}ç‚¹</div>
          <div className="text-purple-600">
            {currentLevel.theme.title}
          </div>
          <div className={`text-red-600 ${timeLeft <= 10 ? 'animate-pulse font-bold text-xl' : ''}`}>
            â° æ®‹ã‚Šæ™‚é–“: {Math.floor(timeLeft / 60)}:{(timeLeft % 60).toString().padStart(2, '0')}
          </div>
          {!gameActive && score > 0 && (
            <div className="text-green-600">æœ€çµ‚ã‚¹ã‚³ã‚¢: {score}ç‚¹</div>
          )}
        </div>

        {/* ã‚²ãƒ¼ãƒ ã‚¨ãƒªã‚¢ */}
        <div 
          id="game-area"
          className={`relative w-full h-96 ${currentLevel.theme.borderColor} border-4 rounded-lg overflow-hidden`}
          style={{ 
            cursor: gameActive ? 'none' : 'default',
            background: currentLevel.theme.background
          }}
          onMouseMove={handleMouseMove}
          onMouseEnter={handleMouseEnter}
          onMouseLeave={handleMouseLeave}
          onClick={handleShoot}
        >
          {/* èƒŒæ™¯è£…é£¾ */}
          <div className={`absolute bottom-0 w-full h-20 bg-gradient-to-t ${currentLevel.theme.groundColor} opacity-50`}></div>
          
          {/* ãƒ¬ãƒ™ãƒ«åˆ¥ã®èƒŒæ™¯è£…é£¾ */}
          {selectedLevel === 'beginner' && (
            <>
              {/* æ£®ã®èƒŒæ™¯è£…é£¾ */}
              <div className="absolute bottom-0 left-10 w-8 h-16 bg-amber-800 rounded-t-lg opacity-70"></div>
              <div className="absolute bottom-16 left-8 w-12 h-8 bg-green-600 rounded-full opacity-60"></div>
              <div className="absolute bottom-0 right-20 w-6 h-12 bg-amber-800 rounded-t-lg opacity-70"></div>
              <div className="absolute bottom-12 right-18 w-10 h-6 bg-green-600 rounded-full opacity-60"></div>
              <div className="absolute top-10 left-1/4 w-2 h-2 bg-yellow-300 rounded-full opacity-80 animate-pulse"></div>
              <div className="absolute top-16 right-1/3 w-1 h-1 bg-yellow-300 rounded-full opacity-80 animate-pulse"></div>
            </>
          )}
          
          {selectedLevel === 'intermediate' && (
            <>
              {/* éƒ½å¸‚ã®èƒŒæ™¯è£…é£¾ */}
              <div className="absolute bottom-0 left-8 w-12 h-24 bg-gray-700 opacity-70"></div>
              <div className="absolute bottom-0 left-24 w-8 h-32 bg-gray-600 opacity-70"></div>
              <div className="absolute bottom-0 right-16 w-10 h-20 bg-gray-800 opacity-70"></div>
              <div className="absolute bottom-0 right-32 w-6 h-28 bg-gray-500 opacity-70"></div>
              <div className="absolute top-6 left-12 w-2 h-1 bg-yellow-400 opacity-90"></div>
              <div className="absolute top-10 left-28 w-1 h-1 bg-yellow-400 opacity-90"></div>
              <div className="absolute top-8 right-20 w-1 h-2 bg-yellow-400 opacity-90"></div>
            </>
          )}
          
          {selectedLevel === 'advanced' && (
            <>
              {/* å®‡å®™ã®èƒŒæ™¯è£…é£¾ */}
              <div className="absolute top-4 left-1/4 w-1 h-1 bg-white rounded-full opacity-90 animate-pulse"></div>
              <div className="absolute top-8 left-3/4 w-1 h-1 bg-blue-300 rounded-full opacity-80 animate-pulse"></div>
              <div className="absolute top-16 left-1/2 w-0.5 h-0.5 bg-white rounded-full opacity-70"></div>
              <div className="absolute top-12 left-1/6 w-0.5 h-0.5 bg-purple-300 rounded-full opacity-80"></div>
              <div className="absolute top-20 right-1/4 w-1 h-1 bg-cyan-300 rounded-full opacity-90 animate-pulse"></div>
              <div className="absolute top-6 right-1/6 w-0.5 h-0.5 bg-white rounded-full opacity-60"></div>
              <div className="absolute top-24 left-2/3 w-0.5 h-0.5 bg-pink-300 rounded-full opacity-70"></div>
              <div className="absolute bottom-20 left-10 w-16 h-8 bg-gray-600 rounded opacity-40"></div>
              <div className="absolute bottom-24 right-12 w-12 h-6 bg-gray-700 rounded opacity-30"></div>
            </>
          )}

          {/* ã‚¢ã‚¤ãƒ†ãƒ ã‚’è¡¨ç¤º */}
          {items.map(item => (
            <div
              key={item.id}
              className="absolute rounded-lg border-2 border-white shadow-lg transform transition-all duration-300 hover:scale-110 animate-bounce"
              style={{
                left: item.x,
                top: item.y,
                width: item.size,
                height: item.size,
                backgroundColor: item.color,
                background: `linear-gradient(45deg, ${item.color}, ${item.color}dd)`
              }}
            >
              <div className="absolute inset-0 flex items-center justify-center text-white font-bold text-lg">
                {item.emoji}
              </div>
              <div className="absolute -top-6 left-1/2 transform -translate-x-1/2 text-xs font-bold text-white bg-black bg-opacity-60 px-1 rounded">
                {item.type === 'timeBonus' && `+${item.timeBonus}ç§’`}
                {item.type === 'scoreBonus' && `+${item.scoreBonus}`}
                {item.type === 'multiShot' && '2å€'}
              </div>
            </div>
          ))}

          {/* æ™‚é–“è­¦å‘Šè¡¨ç¤º */}
          {gameActive && timeLeft <= 10 && timeLeft > 0 && (
            <div className="absolute top-4 left-1/2 transform -translate-x-1/2 text-4xl font-bold text-red-500 animate-pulse bg-white bg-opacity-80 px-4 py-2 rounded-lg">
              {timeLeft}
            </div>
          )}

          {/* ã‚²ãƒ¼ãƒ çµ‚äº†æ™‚ã®è¡¨ç¤º */}
          {!gameActive && !showLevelSelect && timeLeft === 0 && (
            <div className="absolute inset-0 flex items-center justify-center bg-black bg-opacity-70">
              <div className="bg-white p-8 rounded-lg text-center">
                <h2 className="text-3xl font-bold mb-4 text-red-600">â° TIME UP!</h2>
                <p className="text-2xl font-bold text-blue-600 mb-4">æœ€çµ‚ã‚¹ã‚³ã‚¢: {score}ç‚¹</p>
                <p className="text-gray-600 mb-4">{currentLevel.theme.title}ã§ã®æŒ‘æˆ¦ã§ã—ãŸ</p>
                <button
                  onClick={() => setShowLevelSelect(true)}
                  className="px-6 py-3 bg-blue-500 hover:bg-blue-600 text-white font-bold rounded-lg transition-colors"
                >
                  å†æŒ‘æˆ¦
                </button>
              </div>
            </div>
          )}

          {/* çš„ã‚’è¡¨ç¤º */}
          {targets.map(target => (
            <div
              key={target.id}
              className={`absolute rounded-full border-4 shadow-lg transform transition-all duration-300 hover:scale-110 ${
                target.isNegative ? 'animate-pulse' : 
                target.isTimeBomb ? 'animate-bounce' : 
                target.isMoving ? 'animate-spin' : ''
              }`}
              style={{
                left: target.x,
                top: target.y,
                width: target.size,
                height: target.size,
                backgroundColor: target.color,
                background: target.isTimeBomb
                  ? `radial-gradient(circle at 30% 30%, ${target.color}, #000)`
                  : target.isNegative 
                    ? `radial-gradient(circle at 30% 30%, ${target.color}, #000)`
                    : target.isMoving
                      ? `radial-gradient(circle at 30% 30%, ${target.color}, #FF4500)`
                      : `radial-gradient(circle at 30% 30%, ${target.color}, #000)`,
                borderColor: target.isTimeBomb ? '#4B0082' : 
                           target.isNegative ? '#FF0000' : 
                           target.isMoving ? '#FF6B35' : '#FFFFFF',
                boxShadow: target.isMoving ? '0 0 15px rgba(255, 107, 53, 0.6)' : 'none'
              }}
            >
              {target.isTimeBomb ? (
                // æ™‚é–“çˆ†å¼¾çš„ã®ãƒ‡ã‚¶ã‚¤ãƒ³
                <>
                  <div className="absolute inset-2 rounded-full bg-indigo-900 opacity-80"></div>
                  <div className="absolute inset-4 rounded-full bg-purple-600"></div>
                  <div className="absolute inset-6 rounded-full bg-indigo-900 opacity-80"></div>
                  <div className="absolute top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2">
                    <span className="text-white font-bold text-lg">ğŸ’£</span>
                  </div>
                  <div 
                    className="absolute top-1/2 left-1/2 transform -translate-x-1/2 translate-y-1/4 text-purple-300 font-bold text-xs"
                    style={{ fontSize: Math.max(target.size / 12, 6) }}
                  >
                    -{target.timePenalty}s
                  </div>
                </>
              ) : target.isNegative ? (
                // ãƒã‚¤ãƒŠã‚¹çš„ã®ãƒ‡ã‚¶ã‚¤ãƒ³
                <>
                  <div className="absolute inset-2 rounded-full bg-black opacity-80"></div>
                  <div className="absolute inset-4 rounded-full bg-red-600"></div>
                  <div className="absolute inset-6 rounded-full bg-black opacity-80"></div>
                  <div className="absolute top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2">
                    <span className="text-white font-bold text-lg">ğŸ’€</span>
                  </div>
                  <div 
                    className="absolute top-1/2 left-1/2 transform -translate-x-1/2 translate-y-1/4 text-red-300 font-bold text-xs"
                    style={{ fontSize: Math.max(target.size / 10, 6) }}
                  >
                    {target.points}
                  </div>
                </>
              ) : target.isMoving ? (
                // å‹•ãçš„ã®ãƒ‡ã‚¶ã‚¤ãƒ³
                <>
                  <div className="absolute inset-2 rounded-full bg-orange-200 opacity-90"></div>
                  <div className="absolute inset-4 rounded-full bg-orange-500"></div>
                  <div className="absolute inset-6 rounded-full bg-orange-200 opacity-90"></div>
                  <div className="absolute top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2">
                    <span className="text-white font-bold text-lg">âš¡</span>
                  </div>
                  <div 
                    className="absolute top-1/2 left-1/2 transform -translate-x-1/2 translate-y-1/4 text-orange-200 font-bold text-xs"
                    style={{ fontSize: Math.max(target.size / 8, 8) }}
                  >
                    {target.points}
                  </div>
                  {/* å‹•ãã®è»Œè·¡ã‚¨ãƒ•ã‚§ã‚¯ãƒˆ */}
                  <div className="absolute inset-0 rounded-full border-2 border-orange-300 opacity-50 animate-ping"></div>
                  {/* è¿½åŠ ã®å‹•ãã‚¨ãƒ•ã‚§ã‚¯ãƒˆ */}
                  <div className="absolute inset-1 rounded-full border border-yellow-400 opacity-70 animate-pulse"></div>
                </>
              ) : (
                // é€šå¸¸ã®çš„ã®ãƒ‡ã‚¶ã‚¤ãƒ³
                <>
                  <div className="absolute inset-2 rounded-full bg-white opacity-80"></div>
                  <div className="absolute inset-4 rounded-full bg-red-500"></div>
                  <div className="absolute inset-6 rounded-full bg-white opacity-80"></div>
                  <div 
                    className="absolute top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2 text-white font-bold text-xs"
                    style={{ fontSize: Math.max(target.size / 8, 8) }}
                  >
                    {target.points}
                  </div>
                </>
              )}
            </div>
          ))}

          {/* ã‚¯ãƒ­ã‚¹ãƒ˜ã‚¢ï¼ˆç…§æº–ï¼‰ */}
          {showCrosshair && gameActive && (
            <div
              className="absolute pointer-events-none z-50"
              style={{
                left: crosshair.x - 15,
                top: crosshair.y - 15,
                width: 30,
                height: 30
              }}
            >
              <div className="absolute w-full h-0.5 bg-red-500 top-1/2 transform -translate-y-1/2"></div>
              <div className="absolute h-full w-0.5 bg-red-500 left-1/2 transform -translate-x-1/2"></div>
              <div className="absolute inset-2 border-2 border-red-500 rounded-full"></div>
            </div>
          )}

          {/* ãƒ¬ãƒ™ãƒ«é¸æŠç”»é¢ */}
          {showLevelSelect && (
            <div className="absolute inset-0 flex items-center justify-center bg-black bg-opacity-70">
              <div className="bg-white p-8 rounded-lg text-center max-w-lg">
                <h2 className="text-2xl font-bold mb-6">ğŸ¯ ã‚¹ãƒ†ãƒ¼ã‚¸ã‚’é¸æŠã—ã¦ãã ã•ã„</h2>
                <div className="space-y-4">
                  {Object.entries(levelSettings).map(([key, level]) => (
                    <button
                      key={key}
                      onClick={() => selectLevel(key)}
                      className={`w-full p-4 rounded-lg border-2 transition-all ${
                        selectedLevel === key
                          ? 'border-blue-500 bg-blue-50'
                          : 'border-gray-300 hover:border-gray-400'
                      }`}
                    >
                      <div className="flex items-center justify-between">
                        <div className="text-left">
                          <div className="text-lg font-bold">
                            {level.theme.title}
                          </div>
                          <div className="text-sm text-gray-600">
                            {level.theme.description}
                          </div>
                          <div className="text-xs text-gray-500 mt-1">
                            {level.description}
                          </div>
                        </div>
                        <div className="text-right text-sm text-gray-500">
                          <div>åˆ¶é™æ™‚é–“: {level.timeLimit}ç§’</div>
                          <div>çš„ã®æ•°: æœ€å¤§{level.maxTargets}å€‹</div>
                        </div>
                      </div>
                    </button>
                  ))}
                </div>
                <div className="mt-6 p-4 bg-gray-100 rounded-lg text-sm text-gray-700">
                  <h3 className="font-bold mb-2">é¸æŠä¸­: {currentLevel.theme.title}</h3>
                  <p>{currentLevel.theme.description}</p>
                  <p className="mt-1">{currentLevel.description}</p>
                  <p className="mt-1">åˆ¶é™æ™‚é–“: {currentLevel.timeLimit}ç§’ | æœ€å¤§çš„æ•°: {currentLevel.maxTargets}å€‹</p>
                </div>
              </div>
            </div>
          )}

          {/* ã‚²ãƒ¼ãƒ é–‹å§‹å‰ã®èª¬æ˜ï¼ˆãƒ¬ãƒ™ãƒ«é¸æŠå¾Œï¼‰ */}
          {!gameActive && !showLevelSelect && (
            <div className="absolute inset-0 flex items-center justify-center bg-black bg-opacity-50">
              <div className="bg-white p-6 rounded-lg text-center">
                <h2 className="text-xl font-bold mb-4">
                  {currentLevel.theme.title}
                </h2>
                <p className="mb-2 text-gray-600">{currentLevel.theme.description}</p>
                <p className="mb-2">ğŸ¯ çš„ã‚’ã‚¯ãƒªãƒƒã‚¯ã—ã¦æ’ƒã¡è½ã¨ãã†ï¼</p>
                <p className="mb-2">âš¡ ã‚ªãƒ¬ãƒ³ã‚¸ã®å‹•ãçš„ã¯ç‚¹æ•°2å€ï¼</p>
                <p className="mb-2">ğŸ’€ èµ¤ã„æ ã®çš„ã¯å±é™ºï¼ãƒã‚¤ãƒŠã‚¹ãƒã‚¤ãƒ³ãƒˆ</p>
                <p className="mb-2">ğŸ’£ ç´«ã®æ ã®çš„ã¯æ™‚é–“çˆ†å¼¾ï¼æ™‚é–“ãŒæ¸›ã‚‹</p>
                <p className="mb-2">â° ã‚¢ã‚¤ãƒ†ãƒ ã§æ™‚é–“å»¶é•·ï¼†ã‚¹ã‚³ã‚¢ã‚¢ãƒƒãƒ—ï¼</p>
                <p className="mb-2">ğŸ’« å°ã•ã„çš„ã»ã©é«˜å¾—ç‚¹</p>
                <p className="mb-2">ğŸ”« å¼¾æ•°ã¯ç„¡åˆ¶é™ï¼</p>
                <p className="mb-4">â° åˆ¶é™æ™‚é–“: {currentLevel.timeLimit}ç§’</p>
                <p className="text-sm text-gray-600">å‹•ãçš„ã‚’ç‹™ã£ã¦2å€å¾—ç‚¹ã‚’ç²å¾—ã—ã‚ˆã†ï¼</p>
                <button
                  onClick={() => setShowLevelSelect(true)}
                  className="mt-4 px-4 py-2 bg-gray-500 hover:bg-gray-600 text-white text-sm rounded transition-colors"
                >
                  ã‚¹ãƒ†ãƒ¼ã‚¸å¤‰æ›´
                </button>
              </div>
            </div>
          )}
        </div>

        {/* ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ«ãƒœã‚¿ãƒ³ */}
        <div className="flex justify-center gap-4 mt-6">
          {!gameActive ? (
            <div className="flex gap-4">
              {!showLevelSelect && (
                <button
                  onClick={startGame}
                  className="px-6 py-3 bg-green-500 hover:bg-green-600 text-white font-bold rounded-lg transition-colors"
                >
                  ğŸ® ã‚²ãƒ¼ãƒ é–‹å§‹
                </button>
              )}
              <button
                onClick={() => setShowLevelSelect(!showLevelSelect)}
                className="px-6 py-3 bg-blue-500 hover:bg-blue-600 text-white font-bold rounded-lg transition-colors"
              >
                {showLevelSelect ? 'âœ… ã‚¹ãƒ†ãƒ¼ã‚¸ç¢ºå®š' : 'âš™ï¸ ã‚¹ãƒ†ãƒ¼ã‚¸é¸æŠ'}
              </button>
            </div>
          ) : (
            <button
              onClick={endGame}
              className="px-6 py-3 bg-red-500 hover:bg-red-600 text-white font-bold rounded-lg transition-colors"
            >
              ğŸ›‘ ã‚²ãƒ¼ãƒ çµ‚äº†
            </button>
          )}
        </div>

        {/* ãƒ«ãƒ¼ãƒ«èª¬æ˜ */}
        <div className="mt-6 p-4 bg-gray-100 rounded-lg text-sm text-gray-700">
          <h3 className="font-bold mb-2">ğŸ¯ ã‚¹ãƒ†ãƒ¼ã‚¸åˆ¥ãƒ«ãƒ¼ãƒ«èª¬æ˜:</h3>
          <div className="grid md:grid-cols-3 gap-4">
            {Object.entries(levelSettings).map(([key, level]) => (
              <div key={key} className={`p-3 rounded-lg ${selectedLevel === key ? 'bg-blue-100 border border-blue-300' : 'bg-white'}`}>
                <h4 className="font-semibold text-center mb-2">{level.theme.title}</h4>
                <p className="text-xs text-gray-600 mb-2">{level.theme.description}</p>
                <ul className="space-y-1 text-xs">
                  <li>â€¢ åˆ¶é™æ™‚é–“: {level.timeLimit}ç§’</li>
                  <li>â€¢ æœ€å¤§çš„æ•°: {level.maxTargets}å€‹</li>
                  <li>â€¢ çš„ã®å¤§ãã•: {level.minSize}-{level.maxSize}px</li>
                  <li>â€¢ ç”Ÿå­˜æ™‚é–“: {level.targetLifetime/1000}ç§’</li>
                  <li>â€¢ å‡ºç¾é–“éš”: {level.targetInterval/1000}ç§’</li>
                </ul>
              </div>
            ))}
          </div>
          <div className="mt-3 text-center">
            <p className="font-semibold">ğŸ’¡ ã‚³ãƒ„: å‹•ãçš„ğŸ¯ã‚’ç‹™ã£ã¦å¤§é‡å¾—ç‚¹ï¼å±é™ºãªçš„ğŸ’€ğŸ’£ã¯é¿ã‘ã‚ˆã†ï¼</p>
            <div className="mt-2 flex justify-center gap-3 text-xs">
              <span className="flex items-center gap-1">
                <span className="w-4 h-4 bg-orange-500 rounded flex items-center justify-center">â°</span>
                æ™‚é–“å»¶é•· +10ç§’
              </span>
              <span className="flex items-center gap-1">
                <span className="w-4 h-4 bg-yellow-500 rounded flex items-center justify-center">â­</span>
                ã‚¹ã‚³ã‚¢ãƒœãƒ¼ãƒŠã‚¹ +50ç‚¹
              </span>
              <span className="flex items-center gap-1">
                <span className="w-4 h-4 bg-pink-500 rounded flex items-center justify-center">ğŸ†</span>
                2å€ã‚¹ã‚³ã‚¢
              </span>
              <span className="flex items-center gap-1">
                <span className="w-4 h-4 bg-orange-600 rounded flex items-center justify-center border border-orange-800">ğŸ¯</span>
                å‹•ãçš„ï¼ˆé«˜å¾—ç‚¹ï¼‰
              </span>
              <span className="flex items-center gap-1">
                <span className="w-4 h-4 bg-red-600 rounded flex items-center justify-center border border-red-800">ğŸ’€</span>
                ãƒã‚¤ãƒŠã‚¹çš„
              </span>
              <span className="flex items-center gap-1">
                <span className="w-4 h-4 bg-purple-600 rounded flex items-center justify-center border border-purple-800">ğŸ’£</span>
                æ™‚é–“çˆ†å¼¾
              </span>
            </div>
          </div>
        </div>
      </div>
    </div>
  );
};

export default ShootingGame;