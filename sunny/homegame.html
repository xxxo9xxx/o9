<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>è¤’ã‚ã‚²ãƒ¼ãƒ  Online Pro</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://www.gstatic.com/firebasejs/9.1.3/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.1.3/firebase-database-compat.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Zen+Maru+Gothic:wght@700;900&display=swap');
        body { font-family: 'Zen Maru Gothic', sans-serif; touch-action: manipulation; }
        .card-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 8px; }
        .fade-in-zoom { animation: fadeInZoom 0.5s cubic-bezier(0.175, 0.885, 0.32, 1.275) forwards; }
        @keyframes fadeInZoom { from { opacity: 0; transform: scale(0.8); } to { opacity: 1; transform: scale(1); } }
        .san { font-size: 0.6em; color: #fb923c; margin-left: 2px; }
    </style>
</head>
<body class="bg-orange-50 min-h-screen p-4 text-slate-800">

    <div id="app" class="max-w-md mx-auto text-center">
        <header class="mb-6 pt-2">
            <h1 class="text-3xl font-black text-orange-600 italic tracking-tighter leading-none">å‹é”è¤’ã‚ã‚²ãƒ¼ãƒ </h1>
            <p class="text-[9px] font-bold text-orange-400 mt-1 uppercase tracking-[0.2em]">ã€œè‡ªå·±è‚¯å®šæ„Ÿã¶ã¡ä¸Šã’ãƒ‘ãƒ¼ãƒ†ã‚£ãƒ¼ã€œ</p>
            <p id="room-display" class="text-[8px] font-bold text-slate-300 mt-2 tracking-widest uppercase"></p>
        </header>
        
        <div id="game-content"></div>

        <div id="footer-actions" class="mt-12 flex flex-col items-center gap-4">
            <button onclick="forceResetRoom()" class="text-[11px] bg-red-100 text-red-600 px-6 py-3 rounded-full font-bold border border-red-200 shadow-sm active:scale-95 transition-transform">
                âš ï¸ éƒ¨å±‹ã¨è‡ªåˆ†ã®ãƒ‡ãƒ¼ã‚¿ã‚’å®Œå…¨ãƒªã‚»ãƒƒãƒˆ
            </button>
            <p class="text-[9px] text-slate-400 max-w-[200px]">å‹•ã‹ãªããªã£ãŸæ™‚ã‚„ã€æ–°ã—ãã‚²ãƒ¼ãƒ ã‚’ã‚„ã‚Šç›´ã™æ™‚ã«æŠ¼ã—ã¦ãã ã•ã„</p>
        </div>
    </div>

    <script>
        const firebaseConfig = {
            apiKey: "AIzaSyBmzPmehSaV--mn0Hd0S-fd97nf5RX4Dvg",
            authDomain: "membertoiro.firebaseapp.com",
            databaseURL: "https://membertoiro-default-rtdb.asia-southeast1.firebasedatabase.app",
            projectId: "membertoiro",
            storageBucket: "membertoiro.firebasestorage.app",
            messagingSenderId: "858132874746",
            appId: "1:858132874746:web:9d6e1156a350dd396b9043"
        };
        firebase.initializeApp(firebaseConfig);
        const db = firebase.database();
        const urlParams = new URLSearchParams(window.location.search);
        const roomId = urlParams.get('room') || 'praise-pro-room';
        const roomRef = db.ref("praise_rooms/" + roomId);
        document.getElementById('room-display').innerText = "ROOM: " + roomId;

        const KEYWORDS = {
            male: ['ã‹ã£ã“ã„ã„','é ¼ã‚‚ã—ã„','å„ªã—ã„','é¢ç™½ã„','è³¢ã„','ã‚»ãƒ³ã‚¹ãŒã„ã„','ç”·ã‚‰ã—ã„','é­…åŠ›çš„','èª å®Ÿ','åŠªåŠ›å®¶','ãƒã‚¸ãƒ†ã‚£ãƒ–','çŸ¥çš„','ã‚¹ãƒãƒ¼ãƒˆ','æ‰èƒ½ãŒã‚ã‚‹','å­˜åœ¨æ„ŸãŒã‚ã‚‹','å®‰å¿ƒæ„ŸãŒã‚ã‚‹','æƒ…ç†±çš„','å™¨ãŒå¤§ãã„','æ±ºæ–­åŠ›ãŒã‚ã‚‹','ãƒ¦ãƒ¼ãƒ¢ã‚¢ãŒã‚ã‚‹','åŒ…å®¹åŠ›ãŒã‚ã‚‹','ç¤¾äº¤çš„','ã‚¹ãƒˆã‚¤ãƒƒã‚¯','ç¤¼å„€æ­£ã—ã„','ä¿¡å¿µãŒã‚ã‚‹','è¦ªã—ã¿ã‚„ã™ã„','é ¼ã‚Šã«ãªã‚‹','èãä¸Šæ‰‹','è¡Œå‹•åŠ›ãŒã‚ã‚‹','è¬™è™š','å”¯ä¸€ç„¡äºŒ','ã‚¹ã‚¿ã‚¤ãƒ«ãŒã„ã„','ç¬‘é¡”ãŒæ­¦å™¨','ã‚«ãƒªã‚¹ãƒæ€§ãŒã‚ã‚‹','å£°ãŒã„ã„','å®ˆã£ã¦ãã‚Œãã†','å°Šæ•¬ã§ãã‚‹','ã‚ªãƒ¼ãƒ©ãŒã‚ã‚‹','ã‚»ãƒ³ã‚¹ã®å¡Š','å­˜åœ¨ãŒã‚®ãƒ•ãƒˆ','çˆ½ã‚„ã‹','ç†±è¡€','ãƒã‚¤ãƒ«ãƒ‰','å€‹æ€§çš„','å†·é™æ²ˆç€','ãƒŸã‚¹ãƒ†ãƒªã‚¢ã‚¹','ãƒ”ãƒ¥ã‚¢','ãƒ¯ã‚¤ãƒ«ãƒ‰','ç‹å­æ§˜ç³»','ãŠæ´’è½ã•ã‚“','ç”·æ°—ãŒã‚ã‚‹','å™¨ç”¨','ã‚¹ãƒãƒ¼ãƒ„ãƒãƒ³','å‹‰å¼·å®¶','ç™’ã‚„ã—ç³»','æ¸©å’Œ','ç´ ç›´','å®Ÿç›´','åšè­˜','ãƒªãƒ¼ãƒ€ãƒ¼ã‚·ãƒƒãƒ—','èŠ¯ãŒå¼·ã„','ç¾©ç†å …ã„','ãƒ­ãƒãƒ³ãƒã‚¹ãƒˆ','å†’é™ºå¿ƒãŒã‚ã‚‹','å¿è€å¼·ã„','å¯›å¤§','å‡ å¸³é¢','æŸ”è»Ÿãªè€ƒãˆ','æ„›å¬ŒãŒã‚ã‚‹','è½ã¡ç€ã„ã¦ã„ã‚‹','è‹¥ã€…ã—ã„','ç”·å‰','ãƒ€ãƒ³ãƒ‡ã‚£','æ´—ç·´ã•ã‚Œã¦ã„ã‚‹','ç›®ãŒç¶ºéº—','é¼»ç­‹ãŒé€šã£ã¦ã„ã‚‹','æ‰‹ãŒç¶ºéº—','å£°ãŒæ¸‹ã„','ç¬‘é¡”ãŒå¯æ„›ã„','é›°å›²æ°—ãŒã„ã„','è©±ãŒä¸Šæ‰‹ã„','å ´ã‚’å’Œã¾ã›ã‚‹','ã‚®ãƒ£ãƒƒãƒ—ãŒã‚ã‚‹','å®ˆã‚ŠãŸããªã‚‹','ä¸€ç·’ã«ã„ã¦æ¥½','ä¿¡é ¼ã§ãã‚‹','ç›®æ¨™ã«ãªã‚‹äºº','å¿ƒãŒåºƒã„','æ±ºã‚ã‚‹æ™‚ã¯æ±ºã‚ã‚‹','å™¨ãŒãƒ‡ã‚«ã„','ã„ã¤ã‚‚ä¸€ç”Ÿæ‡¸å‘½','ä½•ã§ã‚‚ã“ãªã™','ç²¾ç¥åŠ›ãŒå¼·ã„','ä¸€é€”','è£è¡¨ãŒãªã„','æ­£ç¾©æ„ŸãŒã‚ã‚‹','è½ã¡ç€ããŒã‚ã‚‹','å“ãŒã‚ã‚‹','ã‚ªãƒ¼ãƒ©ã‚’çºã£ã¦ã‚‹'],
            female: ['ç¾ã—ã„','ã‹ã‚ã„ã„','ç´ æ•µ','ä¸Šå“','å„ªã—ã„','æ€ã„ã‚„ã‚ŠãŒã‚ã‚‹','ç™’ã—ç³»','ç¬‘é¡”ãŒç´ æ•µ','æ˜ã‚‹ã„','çŸ¥çš„','æ°—é…ã‚ŠãŒã§ãã‚‹','ã‚»ãƒ³ã‚¹æŠœç¾¤','é­…åŠ›çš„','è¯ã‚„ã‹','é ‘å¼µã‚Šå±‹','ç´”ç²‹','è¦ªã—ã¿ã‚„ã™ã„','æ„›ã•ã‚Œã‚­ãƒ£ãƒ©','ç©ã‚„ã‹','å‡›ã¨ã—ã¦ã„ã‚‹','é€æ˜æ„ŸãŒã‚ã‚‹','ãŠæ´’è½','è©±ã—ã‚„ã™ã„','ãƒŸã‚¹ãƒ†ãƒªã‚¢ã‚¹','å¿ƒãŒåºƒã„','ä¸€ç”Ÿæ‡¸å‘½','å¯æ„›ã‚‰ã—ã„','ä¸å¯§','æ°—å“ãŒã‚ã‚‹','æ„›å¬ŒãŸã£ã·ã‚Š','å”¯ä¸€ç„¡äºŒ','è‚ŒãŒç¶ºéº—','ã‚»ãƒ³ã‚¹ã®å¡Š','å¥³ç¥ã™ãã‚‹','ãƒã‚¸ãƒ†ã‚£ãƒ–','èŠ¯ãŒå¼·ã„','å­˜åœ¨ãŒç™’ã—','æ°—ã•ã','èãä¸Šæ‰‹','å­˜åœ¨ãŒã‚®ãƒ•ãƒˆ','å¯æ†','ã‚¨ãƒ¬ã‚¬ãƒ³ãƒˆ','ã‚­ãƒ¥ãƒ¼ãƒˆ','ã‚¯ãƒ¼ãƒ«ãƒ“ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ¼','å®¶åº­çš„','ã—ã£ã‹ã‚Šè€…','ãŠã£ã¨ã‚Š','ãƒãƒ£ãƒ¼ãƒŸãƒ³ã‚°','æ‰è‰²å…¼å‚™','ãƒ¢ãƒ€ãƒ³','ãƒ¬ãƒˆãƒ­','ãƒŠãƒãƒ¥ãƒ©ãƒ«','éƒ½ä¼šçš„','æ¸…æ¥š','æ´»å‹•çš„','çŒ®èº«çš„','æ„Ÿå—æ€§è±Šã‹','æ„å¿—ãŒå¼·ã„','é­…äº†ã•ã‚Œã‚‹','åŒ…å®¹åŠ›','ã‚¹ã‚¿ã‚¤ãƒ«ãŒã„ã„','æ‰€ä½œãŒç¾ã—ã„','å£°ãŒå¯æ„›ã„','ç›®ãŒã‚­ãƒ©ã‚­ãƒ©','æœãŒä¼¼åˆã£ã¦ã‚‹','å¥³å­åŠ›ãŒé«˜ã„','ã‚»ãƒ³ã‚¹ãŒè‰¯ã„','å®ˆã‚ŠãŸããªã‚‹','æ†§ã‚Œã¡ã‚ƒã†','è‚ŒãŒçœŸã£ç™½','ã¾ã¤æ¯›ãŒé•·ã„','å”‡ãŒç¶ºéº—','çˆªãŒç¶ºéº—','ç¬‘é¡”ãŒæ­¦å™¨','å¤©ä½¿ã¿ãŸã„','ãŠå§‰ã•ã‚“ã£ã½ã„','å¦¹ã£ã½ã„','ã‚®ãƒ£ãƒƒãƒ—èŒãˆ','è©±ã—æ–¹ãŒä¸å¯§','é›°å›²æ°—ãŒæŸ”ã‚‰ã‹ã„','å ´ãŒãƒ‘ãƒƒã¨æ˜ã‚‹ããªã‚‹','æ°—é…ã‚Šä¸Šæ‰‹','èŠ¯ãŒã—ã£ã‹ã‚Šã—ã¦ã‚‹','è‡ªåˆ†ã‚’æŒã£ã¦ã‚‹','ã„ã¤ã‚‚ã‚­ãƒ©ã‚­ãƒ©ã—ã¦ã‚‹','å°Šæ•¬ã—ã¡ã‚ƒã†','å“ä½ãŒã‚ã‚‹','èŠ¸è¡“çš„','è¡¨ç¾åŠ›ãŒè±Šã‹','çœŸã£ç›´ããªå¿ƒ','ç´”æƒ…','é«˜å¶ºã®èŠ±','è¦ªè¿‘æ„ŸãŒã‚ã‚‹','è½ã¡ç€ããŒã‚ã‚‹','æŸ”è»Ÿæ€§ãŒã‚ã‚‹','æ…ˆæ„›ã«æº€ã¡ã¦ã‚‹','é­…åŠ›ãŒæº¢ã‚Œã¦ã‚‹','å“ãŒã‚ã‚‹','ç¥ã€…ã—ã„']
        };

        let myName = localStorage.getItem("h-name") || "";
        let myRole = localStorage.getItem("h-role") || "";
        let myGender = localStorage.getItem("h-gender") || "male";
        let hasRedrawn = false;
        let gameState = null;

        roomRef.on("value", (snapshot) => {
            gameState = snapshot.val();
            // ãƒ‡ãƒ¼ã‚¿ãŒç©ºã«ãªã£ãŸã‚‰å¼·åˆ¶çš„ã«åˆæœŸåŒ–
            if (!gameState && myName) { 
                myName = ""; myRole = ""; 
                localStorage.clear(); 
            }
            render();
        });

        // å¼·åˆ¶ãƒªã‚»ãƒƒãƒˆï¼šFirebaseå‰Šé™¤ ï¼‹ ãƒ­ãƒ¼ã‚«ãƒ«æ¶ˆå» ï¼‹ ãƒªãƒ­ãƒ¼ãƒ‰
        function forceResetRoom() {
            if (confirm("ã€è­¦å‘Šã€‘éƒ¨å±‹ã®å…¨ãƒ‡ãƒ¼ã‚¿ã‚’å‰Šé™¤ã—ã€å…¨å“¡ã‚’åˆæœŸçŠ¶æ…‹ã«æˆ»ã—ã¾ã™ã€‚ã‚ˆã‚ã—ã„ã§ã™ã‹ï¼Ÿ")) {
                roomRef.remove().then(() => {
                    localStorage.clear();
                    window.location.href = window.location.pathname;
                });
            }
        }

        function leaveAndReset() { 
            localStorage.clear(); 
            window.location.href = window.location.pathname; 
        }

        function joinGame(role) {
            const name = document.getElementById('name-input')?.value.trim();
            const gender = document.querySelector('input[name="gender"]:checked')?.value || "male";
            if (!name) { alert("åå‰ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„"); return; }
            
            myName = name; myRole = role; myGender = gender;
            localStorage.setItem("h-name", name); localStorage.setItem("h-role", role); localStorage.setItem("h-gender", gender);
            
            roomRef.transaction((curr) => {
                if (!curr) return { phase: 'setup', members: [{name, gender}], host: (role==='host'?name:"") };
                let m = curr.members || [];
                if (!m.find(x => x.name === name)) m.push({name, gender});
                return { ...curr, members: m, host: (role==='host' ? name : (curr.host || "")) };
            });
        }

        function setParent(targetName) {
            const parentObj = gameState.members.find(m => m.name === targetName);
            const deck = [...KEYWORDS[parentObj.gender]].sort(() => Math.random() - 0.5);
            roomRef.update({ phase: 'voting', parentName: targetName, deck: deck, votes: {}, revealIdx: 0 });
        }

        function getMyHand() {
            if (!gameState || !gameState.deck) return [];
            const myIndex = gameState.members.findIndex(m => m.name === myName);
            const start = myIndex * 6;
            return gameState.deck.slice(start, start + 6);
        }

        function redrawHand() { if (!hasRedrawn) { hasRedrawn = true; render(); } }

        function submitVote(keyword) {
            roomRef.child(`votes/${myName}`).set(keyword).then(() => {
                roomRef.transaction((curr) => {
                    if (curr && Object.keys(curr.votes || {}).length === (curr.members.length - 1)) {
                        curr.phase = 'wait-reveal';
                    }
                    return curr;
                });
            });
        }

        function startRevealing() {
            roomRef.transaction((curr) => {
                if (curr) {
                    curr.phase = 'revealing';
                    curr.revealIdx = 0;
                    curr.shuffledVotes = Object.values(curr.votes).sort(() => Math.random() - 0.5);
                }
                return curr;
            });
        }

        function nextReveal() {
            if (gameState.revealIdx < gameState.shuffledVotes.length - 1) roomRef.update({ revealIdx: gameState.revealIdx + 1 });
            else roomRef.update({ phase: 'result' });
        }

        function setWinner(keyword) {
            const winnerId = Object.keys(gameState.votes).find(k => gameState.votes[k] === keyword);
            roomRef.update({ phase: 'winner-announced', winningKeyword: keyword, winnerName: winnerId });
        }

        function render() {
            const container = document.getElementById('game-content');
            if (!container) return;

            if (!myName) {
                const hostTaken = !!(gameState && gameState.host);
                container.innerHTML = `
                    <div class="bg-white p-6 rounded-3xl shadow-xl fade-in border-2 border-orange-100">
                        <input id="name-input" type="text" placeholder="åå‰ã‚’å…¥åŠ›" class="w-full mb-4 border-2 p-3 rounded-xl font-bold text-center outline-none focus:border-orange-500 bg-orange-50">
                        <div class="flex justify-center gap-4 mb-6">
                            <label class="font-bold text-sm cursor-pointer px-4 py-2 bg-slate-50 rounded-lg"><input type="radio" name="gender" value="male" checked> ç”·æ€§</label>
                            <label class="font-bold text-sm cursor-pointer px-4 py-2 bg-slate-50 rounded-lg"><input type="radio" name="gender" value="female"> å¥³æ€§</label>
                        </div>
                        <div class="flex flex-col gap-3">
                            <button onclick="joinGame('host')" ${hostTaken ? 'disabled' : ''} class="w-full ${hostTaken ? 'bg-gray-200 text-gray-400' : 'bg-orange-600 text-white shadow-md shadow-orange-200'} h-14 rounded-xl font-bold transition-all active:scale-95">
                                ${hostTaken ? 'ãƒ›ã‚¹ãƒˆ (æº€å“¡)' : 'ãƒ›ã‚¹ãƒˆã¨ã—ã¦å‚åŠ '}
                            </button>
                            <button onclick="joinGame('guest')" class="w-full bg-white border-2 border-orange-500 text-orange-600 h-14 rounded-xl font-bold transition-all active:scale-95">
                                ã‚²ã‚¹ãƒˆã¨ã—ã¦å‚åŠ 
                            </button>
                        </div>
                    </div>`;
                return;
            }

            if (!gameState || gameState.phase === 'setup') {
                const members = gameState?.members || [{name: myName}];
                container.innerHTML = `<div class="bg-white p-5 rounded-3xl shadow-xl mb-6 text-center border-2 border-orange-100"><div class="mb-4"><span class="text-orange-600 font-black text-xl">${myName}<small class="san">ã•ã‚“</small></span></div><p class="text-[10px] text-slate-400 font-bold mb-4 uppercase tracking-widest">è¤’ã‚ã‚‰ã‚Œã‚‹äººï¼ˆè¦ªï¼‰ã‚’é¸æŠ</p><div class="grid grid-cols-2 gap-2 max-h-64 overflow-y-auto pr-2">${members.map(m => `<button onclick="setParent('${m.name}')" ${myRole!=='host'?'disabled':''} class="bg-orange-50 p-2 rounded-xl font-bold text-orange-700 text-xs border-2 border-transparent hover:border-orange-400 transition-all">ğŸ‘¤ ${m.name}</button>`).join('')}</div>${myRole !== 'host' ? `<p class="mt-4 text-[10px] text-orange-300 animate-pulse italic font-bold">ãƒ›ã‚¹ãƒˆãŒè¦ªã‚’é¸ã‚“ã§ã„ã¾ã™...</p>` : ''}</div>`;
                return;
            }

            // --- ä»¥é™ã®ãƒ•ã‚§ãƒ¼ã‚ºã¯å…±é€š ---
            if (gameState.phase === 'voting') {
                const isParent = gameState.parentName === myName;
                if (isParent) {
                    container.innerHTML = `<div class="p-10 text-orange-500 font-bold animate-pulse text-sm">ã‚ãªãŸã¯è¦ªã§ã™ã€‚å¾…æ©Ÿä¸­...<br><span class="text-[10px] text-slate-400 mt-2 block">(${Object.keys(gameState.votes || {}).length} / ${gameState.members.length - 1}äººãŒå®Œäº†)</span></div>`;
                } else if (gameState.votes && gameState.votes[myName]) {
                    container.innerHTML = `<div class="p-10 text-orange-500 font-bold animate-pulse text-sm">é€ä¿¡å®Œäº†ï¼å…¨å“¡æƒã†ã¾ã§å¾…æ©Ÿ...</div>`;
                } else {
                    let hand = getMyHand();
                    if (hasRedrawn) {
                        const offset = 70 + (gameState.members.findIndex(m => m.name === myName) * 6);
                        hand = gameState.deck.slice(offset, offset + 6);
                    }
                    container.innerHTML = `<div class="mb-4"><span class="text-[10px] bg-orange-200 text-orange-700 px-3 py-1 rounded-full font-bold">To: ${gameState.parentName}ã•ã‚“</span><h2 class="text-xl font-black text-slate-700 mt-2">æœ€é«˜ã®è¤’ã‚è¨€è‘‰ã‚’é¸ã‚“ã§ï¼</h2></div><div class="card-grid mb-6">${hand.map(k => `<button onclick="submitVote('${k}')" class="h-14 bg-white border-b-4 border-orange-200 rounded-xl font-bold text-orange-600 text-xs shadow-sm active:border-b-0 active:translate-y-1 transition-all px-1">${k}</button>`).join('')}</div><button onclick="redrawHand()" ${hasRedrawn ? 'disabled' : ''} class="w-full ${hasRedrawn ? 'bg-gray-100 text-gray-300' : 'bg-orange-100 text-orange-500 border border-orange-200'} h-10 rounded-xl text-[10px] font-bold uppercase tracking-widest">${hasRedrawn ? 'ã“ã‚Œä»¥ä¸Šã¯å¼•ãç›´ã›ã¾ã›ã‚“' : 'âš¡ï¸ è¨€éœŠã®å†é¸å®šï¼ˆä¸€åº¦ã ã‘å¼•ãç›´ã—ï¼‰'}</button>`;
                }
            }
            else if (gameState.phase === 'wait-reveal') {
                container.innerHTML = `<div class="bg-white p-8 rounded-[2.5rem] shadow-xl fade-in text-center border-4 border-orange-100"><h2 class="text-lg font-black text-slate-700 mb-4 leading-relaxed">å…¨å“¡ã®æŠ•ç¥¨ãŒçµ‚ã‚ã‚Šã¾ã—ãŸï¼<br><span class="text-orange-500">ã¿ã‚“ãªãŒæ€ã†${gameState.parentName}ã•ã‚“ã®<br>è‰¯ã„ã¨ã“ã‚ã‚’ç™ºè¡¨ã—ã¾ã™ã€‚</span></h2>${myRole === 'host' ? `<button onclick="startRevealing()" class="w-full bg-orange-600 text-white h-16 rounded-2xl text-xl font-black shadow-lg active:scale-95 transition-all">OK</button>` : `<p class="text-orange-300 font-bold animate-pulse text-sm">ãƒ›ã‚¹ãƒˆãŒã€ŒOKã€ã‚’æŠ¼ã™ã®ã‚’å¾…ã£ã¦ã„ã¾ã™...</p>`}</div>`;
            }
            else if (gameState.phase === 'revealing') {
                const currentKeyword = gameState.shuffledVotes[gameState.revealIdx];
                container.innerHTML = `<div class="fade-in-zoom"><p class="text-orange-400 font-bold text-[10px] mb-2 uppercase tracking-widest">Compliment ${gameState.revealIdx + 1} / ${gameState.shuffledVotes.length}</p><div class="bg-white py-14 px-4 rounded-[3.5rem] shadow-xl border-4 border-orange-500 mb-8"><p class="text-4xl font-black text-orange-600 tracking-tighter">ã€Œ${currentKeyword}ã€</p></div>${myRole === 'host' ? `<button onclick="nextReveal()" class="w-full bg-orange-600 text-white h-16 rounded-2xl font-bold shadow-lg text-lg active:scale-95 transition-all">æ¬¡ã¸</button>` : `<p class="text-orange-300 font-bold animate-pulse text-sm">ãƒ›ã‚¹ãƒˆãŒã€Œæ¬¡ã¸ã€ã‚’æŠ¼ã™ã®ã‚’å¾…ã£ã¦ã„ã¾ã™...</p>`}</div>`;
            }
            else if (gameState.phase === 'result') {
                const isParent = gameState.parentName === myName;
                const allVotes = Object.values(gameState.votes);
                container.innerHTML = `<div class="fade-in text-center"><h2 class="text-lg font-black mb-6 text-slate-700">${gameState.parentName}ã•ã‚“ã€<br>ä¸€ç•ªã‚°ãƒƒã¨ããŸã®ã¯ã©ã‚Œï¼Ÿ</h2><div class="card-grid mb-8">${allVotes.map(v => `<button onclick="${isParent ? `setWinner('${v}')` : ''}" class="bg-white p-3 rounded-xl font-bold text-orange-600 border-2 border-orange-100 shadow-sm text-xs transition-all active:bg-orange-500 active:text-white">${v}</button>`).join('')}</div>${!isParent ? `<p class="text-orange-300 font-bold animate-pulse text-xs italic">è¦ªãŒé¸ã³ä¸­ã§ã™...</p>` : ''}</div>`;
            }
            else if (gameState.phase === 'winner-announced') {
                container.innerHTML = `<div class="fade-in-zoom text-center"><div class="bg-gradient-to-br from-orange-500 to-orange-600 p-8 rounded-[3.5rem] shadow-xl text-white mb-8"><p class="text-[10px] font-bold mb-2 uppercase opacity-80">Best of Compliment</p><h2 class="text-4xl font-black mb-4 tracking-tighter">ã€Œ${gameState.winningKeyword}ã€</h2><div class="h-px bg-white/20 w-full mb-4"></div><p class="text-lg font-bold">é€ã£ãŸäºº: ${gameState.winnerName}ã•ã‚“</p></div><button onclick="roomRef.update({phase: 'setup', votes: null, parentName: null, deck: null})" class="w-full bg-slate-800 text-white h-16 rounded-2xl font-bold shadow-lg active:scale-95 transition-all">ã‚‚ã†ä¸€åº¦éŠã¶</button></div>`;
            }
        }
    </script>
</body>
</html>