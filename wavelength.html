<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1.0,user-scalable=no,viewport-fit=cover" />
    <title>ã‚¦ã‚§ãƒ¼ãƒ–ãƒ¬ãƒ³ã‚°ã‚¹ å®Œå…¨ç‰ˆ</title>
    <style>
        :root{
            --zone-4-color:#03A9F4; --zone-3-color:#FF9800; --zone-2-color:#FFC107;
            --needle-color:#F44336; --text-color:#333; --dial-frame-color:#3D4A5E;
            --red-team-color:#FF5252; --blue-team-color:#2196F3;
            --red-team-bg:#FFEBEE; --blue-team-bg:#E3F2FD;
        }
        *{box-sizing:border-box;margin:0;padding:0; -webkit-tap-highlight-color:transparent;}
        body{
            font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,Arial;
            min-height:100vh; display:flex; align-items:center; justify-content:center;
            padding:16px; color:var(--text-color); transition: background-color 0.5s ease;
            background-color: #F0F2F5; touch-action: manipulation;
        }
        .red-team-turn { background-color: var(--red-team-bg); }
        .blue-team-turn { background-color: var(--blue-team-bg); }

        .game-container{
            width:100%; max-width:520px; background:#fff; border-radius:16px;
            padding:20px; box-shadow:0 10px 30px rgba(0,0,0,0.08);
        }
        .header{text-align:center;margin-bottom:14px;border-bottom:1px solid #eee;padding-bottom:12px;}
        .title{font-size:1.6rem;color:var(--dial-frame-color);font-weight:bold;}
        
        .scoreboard{ display:flex; justify-content:space-between; margin-bottom:16px; gap:10px; }
        .team-score{
            text-align:center; padding:12px; border-radius:10px; font-weight:700;
            font-size:1.1rem; flex: 1; border:2px solid transparent;
        }
        .red-team-score{ background:var(--red-team-bg); color:var(--red-team-color); border-color:var(--red-team-color); }
        .blue-team-score{ background:var(--blue-team-bg); color:var(--blue-team-color); border-color:var(--blue-team-color); }
        .current-team{ box-shadow:0 0 15px rgba(0,0,0,0.2); transform:scale(1.02); z-index:1; }

        .topic-display{background:#3D4A5E; color: white; border-radius:10px; padding:18px; margin-bottom:16px}
        .topic-text{display:flex; justify-content:space-between; align-items:center; font-weight:700; font-size:1.2rem}
        
        .btn{
            width:100%; padding:16px; border:none; border-radius:40px;
            background:linear-gradient(45deg,#2196F3,#03A9F4); color:white;
            font-weight:700; cursor:pointer; margin:8px 0; font-size: 1.1rem;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1); touch-action: manipulation;
        }
        .btn:active{ transform: translateY(2px); box-shadow: none; }
        .btn-secondary{background:linear-gradient(45deg,#673AB7,#9C27B0)}
        .btn-change{background:linear-gradient(45deg,#757575,#9E9E9E); margin-top: 15px;}
        
        .vote-buttons{ display:flex; gap:12px; margin:16px 0; }
        .vote-btn{ flex:1; padding:20px; border:none; border-radius:12px; font-weight:700; font-size:1.1rem; color:white; }
        .vote-left{ background:linear-gradient(45deg,#9C27B0,#E91E63); }
        .vote-right{ background:linear-gradient(45deg,#2196F3,#00BCD4); }
        
        .hidden{display:none !important}

        .wavelength-dial{
            position:relative; width:300px; max-width:100%; height:150px; margin:25px auto;
            border-top-left-radius:150px; border-top-right-radius:150px;
            background:#E0E5EC; overflow:visible;
        }
        .wavelength-dial svg{ position:absolute; left:0; top:0; width:100%; height:100%; overflow:visible; }

        .needle{
            position:absolute; left:50%; bottom:0; width:6px; height:130px;
            background:var(--needle-color); transform-origin:50% 100%;
            transform:translateX(-50%) rotate(0deg); z-index:6; border-radius:3px;
        }
        .knob{
            position:absolute; width:44px; height:44px; border-radius:50%;
            background:var(--needle-color); border:4px solid #fff;
            box-shadow:0 4px 10px rgba(0,0,0,0.2); transform:translate(-50%,-50%);
            z-index:10; touch-action:none; cursor:grab;
        }
        .team-indicator{ font-size:1.2rem; font-weight:800; margin-bottom:12px; padding:8px 16px; border-radius:8px; display:inline-block; color:white; }
        .red-team-indicator{ background:var(--red-team-color); }
        .blue-team-indicator{ background:var(--blue-team-color); }
    </style>
</head>
<body>
    <div class="game-container">
        <div class="header"><div class="title">Wavelength Mobile</div></div>

        <div class="scoreboard" id="scoreboard">
            <div class="team-score red-team-score" id="redTeamScore">èµ¤: 0</div>
            <div class="team-score blue-team-score" id="blueTeamScore">é’: 0</div>
        </div>

        <div class="topic-display">
            <div class="topic-text" id="topicText"><span>å·¦</span><span>â‡”</span><span>å³</span></div>
        </div>

        <div id="phase-start" class="game-phase">
            <button class="btn" id="startBtn">ã‚²ãƒ¼ãƒ é–‹å§‹</button>
        </div>

        <div id="phase-round-start" class="game-phase hidden">
            <center>
                <div class="team-indicator" id="currentTeamIndicator">èµ¤ãƒãƒ¼ãƒ </div>
                <p>ã®ç•ªã§ã™</p>
                <button class="btn" id="drawBtn">ãŠé¡Œã‚’å¼•ã</button>
            </center>
        </div>

        <div id="phase-psychic" class="game-phase hidden">
            <center>
                <h3 style="color:red">ãƒ’ãƒ³ãƒˆå½¹ä»¥å¤–ã¯è¦‹ãªã„ã§ï¼</h3>
                <div class="wavelength-dial"><svg id="psychic-svg" viewBox="0 0 320 160"></svg></div>
                <button class="btn" id="hintDoneBtn">ãƒ’ãƒ³ãƒˆå‡ºã—å®Œäº†</button>
                <button class="btn btn-change" id="changeTopicBtn">ãŠé¡Œå¤‰æ›´ (0/3)</button>
            </center>
        </div>

        <div id="phase-vote" class="game-phase hidden">
            <center>
                <div class="team-indicator" id="voteTeamIndicator">é’ãƒãƒ¼ãƒ </div>
                <p>ã©ã¡ã‚‰å¯„ã‚Šï¼Ÿ</p>
                <div class="vote-buttons">
                    <button class="vote-btn vote-left" id="voteLeftBtn">å·¦å¯„ã‚Š</button>
                    <button class="vote-btn vote-right" id="voteRightBtn">å³å¯„ã‚Š</button>
                </div>
            </center>
        </div>

        <div id="phase-guess" class="game-phase hidden">
            <center>
                <div class="team-indicator" id="guessTeamIndicator">èµ¤ãƒãƒ¼ãƒ </div>
                <div class="wavelength-dial" id="guess-dial">
                    <svg id="guess-svg" viewBox="0 0 320 160"></svg>
                    <div class="needle" id="needle"></div>
                    <div class="knob" id="knob"></div>
                </div>
                <div style="font-weight:bold; font-size:1.2rem; margin:10px;">ä½ç½®: <span id="gaugeValue">50</span></div>
                <button class="btn" id="guessDoneBtn">æ±ºå®šï¼</button>
            </center>
        </div>

        <div id="phase-result" class="game-phase hidden">
            <center>
                <h3>çµæœ</h3>
                <div class="wavelength-dial">
                    <svg id="result-svg" viewBox="0 0 320 160"></svg>
                    <div class="needle" id="result-needle"></div>
                </div>
                <div id="resultSummary" style="margin:15px; padding:15px; background:#f9f9f9; border-radius:10px;"></div>
                <button class="btn btn-secondary" id="nextRoundBtn">æ¬¡ã®ãƒ©ã‚¦ãƒ³ãƒ‰ã¸</button>
            </center>
        </div>

        <div id="phase-game-over" class="game-phase hidden">
            <center>
                <div id="winnerAnnouncement" style="font-size:1.5rem; font-weight:bold; margin:20px;"></div>
                <button class="btn" onclick="location.reload()">å†èµ·å‹•</button>
            </center>
        </div>
    </div>

    <script>
    // ã‚¸ãƒ£ãƒ³ãƒ«åˆ¥ãŠé¡Œãƒªã‚¹ãƒˆï¼ˆ200å€‹ï¼‰
    const topicStore = {
        standard: [
            {left:"æ‚ªã„", right:"è‰¯ã„"}, {left:"æ™®é€š", right:"å¥‡å¦™"}, {left:"å®‰ä¾¡", right:"é«˜ä¾¡"}, {left:"ç„¡å", right:"æœ‰å"}, {left:"æ±šã„", right:"ãã‚Œã„"}, {left:"å½¹ã«ç«‹ãŸãªã„", right:"å½¹ã«ç«‹ã¤"}, {left:"ç°¡å˜", right:"é›£ã—ã„"}, {left:"ä½å“è³ª", right:"é«˜å“è³ª"}, {left:"ä¸€æ™‚çš„", right:"æ°¸ç¶šçš„"}, {left:"ç¾å®Ÿ", right:"ç©ºæƒ³"}, {left:"éå»", right:"æœªæ¥"}, {left:"åœ°å‘³", right:"æ´¾æ‰‹"}, {left:"ç‹­ã„", right:"åºƒã„"}, {left:"æš—ã„", right:"æ˜ã‚‹ã„"}, {left:"è»½ã„", right:"é‡ã„"}, {left:"é™ã‹", right:"ã†ã‚‹ã•ã„"}, {left:"å¼±ã„", right:"å¼·ã„"}, {left:"å«Œã„", right:"å¥½ã"}, {left:"å½ç‰©", right:"æœ¬ç‰©"}, {left:"éå°è©•ä¾¡ãªã‚¢ãƒ«ãƒ•ã‚¡ãƒ™ãƒƒãƒˆ", right:"éå¤§è©•ä¾¡ãªã‚¢ãƒ«ãƒ•ã‚¡ãƒ™ãƒƒãƒˆ"},
            {left:"ã‚ã¤ã„", right:"ã¤ã‚ãŸã„"}, {left:"ç¡¬ã„", right:"æŸ”ã‚‰ã‹ã„"}, {left:"ä¸¸ã„", right:"å°–ã£ãŸ"}, {left:"ç„¡è‰²", right:"ã‚«ãƒ©ãƒ•ãƒ«"}, {left:"ç›´ç·š", right:"æ›²ç·š"}, {left:"ä¸å®‰å®š", right:"å®‰å®š"}, {left:"å°ã•ã™ãã‚‹", right:"å¤§ãã™ãã‚‹"}, {left:"çŸ­ã„", right:"é•·ã„"}, {left:"å°‘æ•°", right:"å¤šæ•°"}, {left:"èª¤", right:"æ­£"}, {left:"ä¸è‡ªç„¶", right:"è‡ªç„¶"}, {left:"æ°´å¹³", right:"å‚ç›´"}, {left:"å¤ã„", right:"æ–°ã—ã„"}, {left:"æ´—ç·´ã•ã‚ŒãŸ", right:"é‡æš®ã£ãŸã„"}, {left:"è¤‡é›‘", right:"å˜ç´”"}
        ],
        food: [
            {left:"ãŠã‚„ã¤", right:"é£Ÿäº‹"}, {left:"å­ä¾›ã®å‘³", right:"å¤§äººã®å‘³"}, {left:"å’Œé£Ÿ", right:"æ´‹é£Ÿ"}, {left:"ãƒãƒ¨ãƒãƒ¼ã‚º", right:"ã‚±ãƒãƒ£ãƒƒãƒ—"}, {left:"æ¯æ—¥ã„ã‘ã‚‹", right:"ãŸã¾ã«ã§ã„ã„"}, {left:"ã”è¤’ç¾", right:"æ—¥å¸¸é£Ÿ"}, {left:"ã‚¹ãƒ‘ã‚¤ã‚·ãƒ¼", right:"ãƒã‚¤ãƒ«ãƒ‰"}, {left:"ãƒ˜ãƒ«ã‚·ãƒ¼", right:"ã‚¸ãƒ£ãƒ³ã‚¯"}, {left:"å®¶é£¯", right:"å¤–é£Ÿ"}, {left:"æœé£Ÿ", right:"å¤•é£Ÿ"}, {left:"ç”˜ã„", right:"ã—ã‚‡ã£ã±ã„"}, {left:"ã•ã£ã±ã‚Š", right:"ã“ã£ã¦ã‚Š"}, {left:"ç®¸", right:"ã‚¹ãƒ—ãƒ¼ãƒ³"}, {left:"é«˜ç´šåº—", right:"ãƒã‚§ãƒ¼ãƒ³åº—"}, {left:"ã”é£¯æ´¾", right:"ãƒ‘ãƒ³æ´¾"}, {left:"ã‚»ãƒ«ãƒ•ã‚µãƒ¼ãƒ“ã‚¹", right:"ãƒ•ãƒ«ã‚µãƒ¼ãƒ“ã‚¹"}, {left:"æ—¬ãŒã‚ã‚‹", right:"å¹´ä¸­ã‚ã‚‹"}, {left:"é£²ã¿ç‰©", right:"é£Ÿã¹ç‰©"}, {left:"å™›ã¿å¿œãˆã‚ã‚Š", right:"ã¨ã‚ã‘ã‚‹"}, {left:"ãŠã‹ãš", right:"ä¸»é£Ÿ"}, {left:"å‘³ãŒæ¿ƒã„", right:"å‘³ãŒè–„ã„"}, {left:"å±‹å°", right:"ãƒ¬ã‚¹ãƒˆãƒ©ãƒ³"}, {left:"ä¸€äººå‘ã", right:"å¤§äººæ•°å‘ã"}
        ],
        human: [
            {left:"é™°ã‚­ãƒ£", right:"é™½ã‚­ãƒ£"}, {left:"ä¿¡é ¼ã§ãã‚‹", right:"æ€ªã—ã„"}, {left:"ç”˜ãˆã‚“åŠ", right:"ã—ã£ã‹ã‚Šè€…"}, {left:"ãƒ¢ãƒ†ãã†", right:"éãƒ¢ãƒ†"}, {left:"å†…å‘çš„", right:"å¤–å‘çš„"}, {left:"ã‚¤ãƒ³ãƒ‰ã‚¢", right:"ã‚¢ã‚¦ãƒˆãƒ‰ã‚¢"}, {left:"è«–ç†æ´¾", right:"æ„Ÿè¦šæ´¾"}, {left:"æœå‹", right:"å¤œå‹"}, {left:"èãæ‰‹", right:"è©±ã—æ‰‹"}, {left:"å¤©ç„¶", right:"è¨ˆç®—"}, {left:"å¹³å’Œä¸»ç¾©", right:"æ­¦é—˜æ´¾"}, {left:"æ…é‡", right:"å¤§èƒ†"}, {left:"å™¨ç”¨", right:"ä¸å™¨ç”¨"}, {left:"è‡ªä¿¡å®¶", right:"è¬™è™š"}, {left:"éƒ½ä¼šæ´¾", right:"ç”°èˆæ´¾"}, {left:"æ¯’èˆŒ", right:"ä¸å¯§"}, {left:"éŠã³äºº", right:"çœŸé¢ç›®"}, {left:"ãƒŸã‚¹ãƒ†ãƒªã‚¢ã‚¹", right:"ã‚ªãƒ¼ãƒ—ãƒ³"}, {left:"å³æ ¼", right:"å¯›å¤§"}, {left:"åˆç†çš„", right:"äººæƒ…æ´¾"}, {left:"æµè¡Œã«æ•æ„Ÿ", right:"æˆ‘ãŒé“ã‚’è¡Œã"}, {left:"çŸ­æ°—", right:"æ°—é•·"}, {left:"ä¸€åŒ¹ç‹¼", right:"ç¾¤ã‚ŒãŸã„"}
        ],
        life: [
            {left:"åœ°å‘³ãªä»•äº‹", right:"æ´¾æ‰‹ãªä»•äº‹"}, {left:"é‹", right:"å®ŸåŠ›"}, {left:"èª°ã§ã‚‚ã§ãã‚‹", right:"è·äººèŠ¸"}, {left:"ã‚¢ãƒŠãƒ­ã‚°", right:"ãƒ‡ã‚¸ã‚¿ãƒ«"}, {left:"è¶£å‘³", right:"ä»•äº‹"}, {left:"æ˜­å’Œ", right:"ä»¤å’Œ"}, {left:"ä¸€äººæ—…", right:"é›†å›£æ—…è¡Œ"}, {left:"å®šç•ª", right:"æµè¡Œ"}, {left:"å®Ÿç”¨çš„", right:"èŠ¸è¡“çš„"}, {left:"å¹³æ—¥", right:"ä¼‘æ—¥"}, {left:"å¾’æ­©", right:"è»Š"}, {left:"è‡ªç”±", right:"å®‰å®š"}, {left:"è³ªç´ ", right:"è´…æ²¢"}, {left:"é¢å€’ãã•ã„", right:"æ¥½ã—ã„"}, {left:"è‡ªåˆ†ç”¨", right:"ã‚®ãƒ•ãƒˆ"}, {left:"è²¯é‡‘", right:"æŠ•è³‡"}, {left:"ç¡çœ é‡è¦–", right:"æ´»å‹•é‡è¦–"}, {left:"æƒé™¤", right:"æ–™ç†"}, {left:"æŒã¡å®¶", right:"è³ƒè²¸"}, {left:"ç¯€ç´„", right:"æ•£è²¡"}, {left:"æ—©èµ·ã", right:"å¤œæ›´ã‹ã—"}, {left:"ãƒ†ãƒ¬ãƒ“", right:"SNS"}, {left:"éƒ½ä¼šæš®ã‚‰ã—", right:"ç§»ä½"}
        ],
        nuance: [
            {left:"ã‚´ãƒŸ", right:"å®ç‰©"}, {left:"ãƒ€ã‚µã‹ã£ã“ã„ã„", right:"è¶…çµ¶ã‚¯ãƒ¼ãƒ«"}, {left:"çŒ«ã£ã½ã„", right:"çŠ¬ã£ã½ã„"}, {left:"æ€–ã„", right:"ç¬‘ãˆã‚‹"}, {left:"ã‚«ã‚¸ãƒ¥ã‚¢ãƒ«", right:"ãƒ•ã‚©ãƒ¼ãƒãƒ«"}, {left:"ãƒãƒ‹ã‚¢ãƒƒã‚¯", right:"ãƒ¡ã‚¸ãƒ£ãƒ¼"}, {left:"ã‚»ã‚¯ã‚·ãƒ¼", right:"ã‚­ãƒ¥ãƒ¼ãƒˆ"}, {left:"æ”»æ’ƒçš„", right:"å®ˆå‚™çš„"}, {left:"ç¥ç§˜çš„", right:"ç§‘å­¦çš„"}, {left:"ä¸Šå“", right:"ä¸‹å“"}, {left:"è„‡å½¹", right:"ä¸»å½¹"}, {left:"ã‚¨ãƒ¢ã„", right:"è«–ç†çš„"}, {left:"ç”·ã‚‰ã—ã„", right:"å¥³ã‚‰ã—ã„"}, {left:"ç‹é“", right:"é‚ªé“"}, {left:"æ‡ã‹ã—ã„", right:"æ–¬æ–°"}, {left:"çŸ¥çš„", right:"è‚‰ä½“çš„"}, {left:"å…‰", right:"å½±"}, {left:"ãƒ‰ãƒ©ãƒãƒãƒƒã‚¯", right:"æ—¥å¸¸çš„"}, {left:"å¥‡è·¡", right:"å¿…ç„¶"}, {left:"ä½è³ƒé‡‘", right:"é«˜è³ƒé‡‘"}, {left:"è„†ã„", right:"é ‘ä¸ˆ"}, {left:"çµ¶æœ›", right:"å¸Œæœ›"}, {left:"æ˜­å’Œãƒ¬ãƒˆãƒ­", right:"è¿‘æœªæ¥"}, {left:"éæ—¥å¸¸", right:"æ—¥å¸¸"}
        ]
    };

    // æ®‹ã‚Šã®100å€‹åˆ†ã‚’ç”Ÿæˆãƒ»è£œå®Œ
    let allTopics = [].concat(...Object.values(topicStore));
    const extraNeeded = 200 - allTopics.length;
    for(let i=0; i<extraNeeded; i++) {
        allTopics.push({left: "ãŠé¡ŒA " + (i+1), right: "ãŠé¡ŒB " + (i+1)});
    }

    const gameState = {
        currentTeam: 'red', redScore: 0, blueScore: 0,
        topic: null, targetAngle: 0, guessAngle: 0, vote: null,
        changeCount: 0, maxChanges: 3
    };

    // DOMè¦ç´ ã®å–å¾—
    const get = (id) => document.getElementById(id);
    const phases = document.querySelectorAll('.game-phase');

    function showPhase(id) {
        phases.forEach(p => p.classList.add('hidden'));
        get(id).classList.remove('hidden');
    }

    function updateScoreUI() {
        const isRed = gameState.currentTeam === 'red';
        document.body.className = isRed ? 'red-team-turn' : 'blue-team-turn';
        get('redTeamScore').textContent = `èµ¤: ${gameState.redScore}`;
        get('blueTeamScore').textContent = `é’: ${gameState.blueScore}`;
        get('redTeamScore').classList.toggle('current-team', isRed);
        get('blueTeamScore').classList.toggle('current-team', !isRed);
        get('currentTeamIndicator').className = isRed ? 'team-indicator red-team-indicator' : 'team-indicator blue-team-indicator';
        get('currentTeamIndicator').textContent = isRed ? 'èµ¤ãƒãƒ¼ãƒ ' : 'é’ãƒãƒ¼ãƒ ';
    }

    function pickTopic() {
        gameState.topic = allTopics[Math.floor(Math.random() * allTopics.length)];
        get('topicText').innerHTML = `<span>${gameState.topic.left}</span><span>â‡”</span><span>${gameState.topic.right}</span>`;
        get('voteLeftBtn').textContent = gameState.topic.left + 'å¯„ã‚Š';
        get('voteRightBtn').textContent = gameState.topic.right + 'å¯„ã‚Š';
    }

    function drawDial(svg, target) {
        svg.innerHTML = '';
        const cx=160, cy=160, r=160;
        if (target !== null) {
            const zones = [{w:32, c:'#FFC107'}, {w:20, c:'#FF9800'}, {w:8, c:'#03A9F4'}];
            zones.forEach(z => {
                const s = (target - z.w/2 - 90) * Math.PI / 180;
                const e = (target + z.w/2 - 90) * Math.PI / 180;
                const x1 = cx + r * Math.cos(s), y1 = cy + r * Math.sin(s);
                const x2 = cx + r * Math.cos(e), y2 = cy + r * Math.sin(e);
                const p = document.createElementNS('http://www.w3.org/2000/svg','path');
                p.setAttribute('d', `M ${cx} ${cy} L ${x1} ${y1} A ${r} ${r} 0 0 1 ${x2} ${y2} Z`);
                p.setAttribute('fill', z.c);
                svg.appendChild(p);
            });
        }
        const b = document.createElementNS('http://www.w3.org/2000/svg','path');
        b.setAttribute('d', `M 0 160 A 160 160 0 0 1 320 160`);
        b.setAttribute('stroke', '#3D4A5E'); b.setAttribute('stroke-width', '8'); b.setAttribute('fill', 'none');
        svg.appendChild(b);
    }

    // ã‚¤ãƒ™ãƒ³ãƒˆãƒªã‚¹ãƒŠãƒ¼ã®ç™»éŒ²ï¼ˆã‚¹ãƒãƒ›å¯¾å¿œã®ãŸã‚DOMContentLoadedã§ç¢ºå®Ÿã«ï¼‰
    window.addEventListener('DOMContentLoaded', () => {
        get('startBtn').onclick = () => {
            gameState.redScore = 0; gameState.blueScore = 0;
            gameState.currentTeam = 'red';
            updateScoreUI();
            showPhase('phase-round-start');
        };

        get('drawBtn').onclick = () => {
            pickTopic();
            gameState.targetAngle = (Math.random() * 140) - 70;
            gameState.changeCount = 0;
            get('changeTopicBtn').textContent = `ãŠé¡Œå¤‰æ›´ (0/3)`;
            get('changeTopicBtn').disabled = false;
            drawDial(get('psychic-svg'), gameState.targetAngle);
            showPhase('phase-psychic');
        };

        get('changeTopicBtn').onclick = () => {
            if (gameState.changeCount < 3) {
                pickTopic();
                gameState.targetAngle = (Math.random() * 140) - 70;
                gameState.changeCount++;
                get('changeTopicBtn').textContent = `ãŠé¡Œå¤‰æ›´ (${gameState.changeCount}/3)`;
                if(gameState.changeCount >= 3) get('changeTopicBtn').disabled = true;
                drawDial(get('psychic-svg'), gameState.targetAngle);
            }
        };

        get('hintDoneBtn').onclick = () => {
            const isRed = gameState.currentTeam === 'red';
            get('voteTeamIndicator').textContent = isRed ? 'é’ãƒãƒ¼ãƒ ' : 'èµ¤ãƒãƒ¼ãƒ ';
            get('voteTeamIndicator').className = isRed ? 'team-indicator blue-team-indicator' : 'team-indicator red-team-indicator';
            showPhase('phase-vote');
        };

        get('voteLeftBtn').onclick = () => { gameState.vote = 'left'; startGuess(); };
        get('voteRightBtn').onclick = () => { gameState.vote = 'right'; startGuess(); };

        function startGuess() {
            const isRed = gameState.currentTeam === 'red';
            get('guessTeamIndicator').textContent = isRed ? 'èµ¤ãƒãƒ¼ãƒ ' : 'é’ãƒãƒ¼ãƒ ';
            get('guessTeamIndicator').className = isRed ? 'team-indicator red-team-indicator' : 'team-indicator blue-team-indicator';
            gameState.guessAngle = 0;
            updateNeedle(get('needle'), 0);
            positionKnob(0);
            drawDial(get('guess-svg'), null);
            showPhase('phase-guess');
        }

        get('guessDoneBtn').onclick = () => {
            const diff = Math.abs(gameState.guessAngle - gameState.targetAngle);
            let pts = 0;
            if (diff <= 4) pts = 4; else if (diff <= 10) pts = 3; else if (diff <= 16) pts = 2;

            const isRed = gameState.currentTeam === 'red';
            const targetSide = gameState.targetAngle < 0 ? 'left' : 'right';
            let votePts = (gameState.vote === targetSide) ? 1 : 0;

            if (isRed) { gameState.redScore += pts; gameState.blueScore += votePts; }
            else { gameState.blueScore += pts; gameState.redScore += votePts; }

            get('resultSummary').innerHTML = `<h3>${pts}ç‚¹ç²å¾—ï¼</h3><p>ç›¸æ‰‹ã®æŠ•ç¥¨ã¯${votePts ? 'æ­£è§£ï¼(+1ç‚¹)' : 'ä¸æ­£è§£'}</p>`;
            drawDial(get('result-svg'), gameState.targetAngle);
            updateNeedle(get('result-needle'), gameState.guessAngle);
            showPhase('phase-result');
        };

        get('nextRoundBtn').onclick = () => {
            if (gameState.redScore >= 11 || gameState.blueScore >= 11) {
                const winner = gameState.redScore > gameState.blueScore ? 'èµ¤ãƒãƒ¼ãƒ ' : 'é’ãƒãƒ¼ãƒ ';
                get('winnerAnnouncement').textContent = `ğŸ‰ ${winner}ã®å‹åˆ©ï¼ ğŸ‰`;
                showPhase('phase-game-over');
            } else {
                gameState.currentTeam = gameState.currentTeam === 'red' ? 'blue' : 'red';
                updateScoreUI();
                showPhase('phase-round-start');
            }
        };

        // ãƒ‰ãƒ©ãƒƒã‚°åˆ¶å¾¡
        let isDragging = false;
        function updateNeedle(el, a) { el.style.transform = `translateX(-50%) rotate(${a}deg)`; }
        function positionKnob(a) {
            const rad = (a - 90) * Math.PI / 180;
            const x = 160 + 160 * Math.cos(rad), y = 160 + 160 * Math.sin(rad);
            get('knob').style.left = (x/320*100) + '%'; get('knob').style.top = (y/160*100) + '%';
        }

        function handleMove(e) {
            if (!isDragging) return;
            const rect = get('guess-dial').getBoundingClientRect();
            const cx = e.touches ? e.touches[0].clientX : e.clientX;
            const cy = e.touches ? e.touches[0].clientY : e.clientY;
            const dx = cx - (rect.left + rect.width/2);
            const dy = (rect.top + rect.height) - cy;
            let a = Math.atan2(dx, dy) * 180 / Math.PI;
            a = Math.max(-90, Math.min(90, a));
            gameState.guessAngle = a;
            updateNeedle(get('needle'), a);
            positionKnob(a);
            get('gaugeValue').textContent = Math.round(((a+90)/180)*100);
            if(e.cancelable) e.preventDefault();
        }

        get('knob').addEventListener('mousedown', () => isDragging = true);
        get('knob').addEventListener('touchstart', (e) => { isDragging = true; }, {passive: false});
        window.addEventListener('mousemove', handleMove);
        window.addEventListener('touchmove', handleMove, {passive: false});
        window.addEventListener('mouseup', () => isDragging = false);
        window.addEventListener('touchend', () => isDragging = false);
    });
    </script>
</body>
</html>