<!doctype html>
<html lang="ja">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>ãƒ‰ã‚­ãƒ‰ã‚­å ã„ãƒã‚·ãƒ¼ãƒ³ï½œãŠç¥­ã‚Šç‰ˆ</title>
  <style>
    @import url('https://fonts.googleapis.com/css2?family=M+PLUS+Rounded+1c:wght@500;800;900&display=swap');
    * { box-sizing: border-box; }
    body { font-family: 'M PLUS Rounded 1c', sans-serif; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: #333; margin: 0; padding: 20px; min-height: 100vh; }
    .container { max-width: 900px; margin: 0 auto; }
    .header { text-align: center; margin-bottom: 30px; animation: fadeInDown 0.6s ease-out; }
    .festival-name { background: white; display: inline-block; padding: 8px 24px; border-radius: 20px; font-size: 18px; font-weight: 800; color: #667eea; margin-bottom: 10px; box-shadow: 0 4px 15px rgba(0,0,0,0.2); }
    .main-title { font-size: 56px; font-weight: 900; color: white; text-shadow: 4px 4px 0 rgba(0,0,0,0.3); margin: 10px 0; letter-spacing: 4px; }
    .main-title::before, .main-title::after { content: 'âœ¨'; margin: 0 15px; }
    .input-card { background: white; border-radius: 30px; padding: 40px; box-shadow: 0 20px 60px rgba(0,0,0,0.3); margin-bottom: 30px; animation: fadeInUp 0.6s ease-out 0.2s both; }
    .form-group { margin-bottom: 25px; }
    .label { display: block; font-size: 22px; font-weight: 800; color: #333; margin-bottom: 10px; padding-left: 5px; }
    .label .emoji { font-size: 28px; margin-right: 8px; }
    .input-field { width: 100%; font-size: 28px; font-family: inherit; padding: 20px; border: 4px solid #e0e7ff; border-radius: 20px; background: #f8faff; transition: all 0.3s; }
    .input-field:focus { outline: none; border-color: #667eea; box-shadow: 0 0 0 4px rgba(102, 126, 234, 0.1); transform: translateY(-2px); }
    .date-row { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; }
    .gender-selector { display: grid; grid-template-columns: repeat(3, 1fr); gap: 15px; }
    .gender-selector label { display: flex; flex-direction: column; align-items: center; justify-content: center; padding: 15px; border: 4px solid #e0e7ff; border-radius: 20px; cursor: pointer; transition: all 0.2s; position: relative; }
    .gender-selector .icon { font-size: 48px; line-height: 1; }
    .gender-selector .text { font-size: 18px; font-weight: 800; margin-top: 8px; }
    .gender-selector input { position: absolute; opacity: 0; width: 0; height: 0; }
    .gender-selector input:checked + label { background-color: #e0e7ff; border-color: #667eea; color: #667eea; transform: translateY(-5px); box-shadow: 0 8px 20px rgba(102, 126, 234, 0.2); }
    .button-group { display: flex; gap: 20px; margin-top: 35px; }
    .btn { flex: 1; font-size: 28px; font-weight: 900; font-family: inherit; padding: 25px; border: none; border-radius: 20px; cursor: pointer; transition: all 0.2s; box-shadow: 0 8px 0 rgba(0,0,0,0.2); position: relative; top: 0; }
    .btn:active { top: 8px; box-shadow: 0 0 0 rgba(0,0,0,0.2); }
    .btn-primary { background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%); color: white; }
    .btn:hover { transform: scale(1.02); }
    .preview-section { display: none; animation: fadeInUp 0.6s ease-out; }
    .preview-section.show { display: block; }
    .preview-header { text-align: center; margin-bottom: 20px; }
    .preview-title { font-size: 32px; font-weight: 900; color: white; text-shadow: 2px 2px 4px rgba(0,0,0,0.3); }
    .screen-preview-wrapper { background: white; border-radius: 20px; padding: 30px; box-shadow: 0 20px 60px rgba(0,0,0,0.3); }
    
    .print-preview { border: 3px dashed #f472b6; border-radius: 12px; padding: 14mm 7mm; box-shadow: 0 10px 40px rgba(0,0,0,0.2); display: flex; flex-direction: column; max-width: 515px; margin: 0 auto 30px; background: white; }
    .preview-head { text-align: center; margin-bottom: 10px; flex-shrink: 0; }
    .preview-festival { font-size: 14px; color: #667eea; font-weight: 800; margin-bottom: 5px; }
    .preview-main-title { font-size: 22px; font-weight: 900; color: #ff8c00; margin: 0; }
    .preview-score { font-size: 24px; font-weight: 900; margin: 8px 0; }
    .preview-score span { color: #ef4444; font-size: 32px; } 
    .fortune-grid { display: flex; flex-direction: column; gap: 10px; min-height: 0; margin-top: 15px; }
    .fortune-item {
      border: 1px solid #e5e7eb; border-radius: 10px; padding: 12px;
      display: flex; flex-direction: column;
      height: 210px;
    }
    .fortune-item:nth-child(1) { background: #f0f9ff; } .fortune-item:nth-child(2) { background: #fefce8; } .fortune-item:nth-child(3) { background: #fff1f2; }
    .fortune-header { display: flex; justify-content: space-between; align-items: baseline; border-bottom: 2px dotted #f9a8d4; padding-bottom: 4px; margin-bottom: 6px; flex-shrink: 0; }
    .fortune-label { font-weight: 700; font-size: 16px; }
    .fortune-meter { font-size: 20px; letter-spacing: 4px; flex-shrink: 0; }
    .fortune-text {
      white-space: pre-wrap; font-family: inherit;
      font-size: 14px;      
      line-height: 1.65;
      margin-top: 6px;
      overflow: hidden; 
    }
    .lucky-row { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-top: 15px; flex-shrink: 0; }
    .lucky-box {
      border: 1px solid #e5e7eb; border-radius: 8px; padding: 10px;
      background: #dcfce7; text-align: center;
      height: 85px; 
      display: flex; flex-direction: column; justify-content: center;
    }
    .lucky-label { font-size: 14px; font-weight: 700; margin-bottom: 4px; }
    .lucky-value { font-size: 22px; font-weight: 900; color: #dd571c; }
    .print-actions { display: flex; gap: 15px; margin-top: 20px; }
    .btn-print { flex: 2; background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%); color: white; font-size: 32px; padding: 25px; }
    .btn-back { flex: 1; background: #9ca3af; color: white; font-size: 20px; padding: 25px; }
    .stats-bar { background: rgba(255,255,255,0.2); border-radius: 15px; padding: 15px; margin-top: 20px; text-align: center; backdrop-filter: blur(10px); }
    .stats-text { color: white; font-size: 18px; font-weight: 700; }
    @keyframes fadeInDown { from { opacity: 0; transform: translateY(-30px); } to { opacity: 1; transform: translateY(0); } }
    @keyframes fadeInUp { from { opacity: 0; transform: translateY(30px); } to { opacity: 1; transform: translateY(0); } }

    @media print {
      @page { size: 100mm 148mm; margin: 0; }
      body { background: white !important; padding: 0 !important; margin: 0 !important; -webkit-font-smoothing: antialiased; }
      body > .container > main > *:not(.preview-section), body > .container > header, body > .container > footer { display: none !important; }
      .preview-section, .screen-preview-wrapper { display: block !important; animation: none !important; margin: 0 !important; padding: 0 !important; box-shadow: none !important; background: none !important; border: none !important; }
      .print-actions, .preview-header { display: none !important; }

      .print-preview {
        position: absolute; top: 0; left: 0; width: 100mm; height: 148mm;
        margin: 0 !important; padding: 15mm 5mm 5mm 5mm !important;
        border: none !important; box-shadow: none !important; page-break-after: always;
        display: flex; flex-direction: column;
        background: none !important; 
      }
      .preview-head { margin-bottom: 1mm; flex-shrink: 0; text-align: center; }
      .preview-festival, .preview-main-title { display: none !important; }
      
      .preview-score { font-size: 15px; margin: 1.5mm 0; line-height: 1.2; }
      .preview-score span { font-size: 18px; }
      .preview-score span#previewNameText { color: #ff8c00 !important; }
      .preview-score span#previewScore { color: #ef4444 !important; font-size: 22px; }

      .fortune-grid { gap: 2mm; margin-top: 1mm; display: flex; flex-direction: column; }
      
      .fortune-item {
        padding: 1mm; border-radius: 0;
        height: 32mm; 
        display: flex; flex-direction: column;
        flex-grow: 0; flex-shrink: 0;
        border: 1px solid white !important;
        background: none !important; 
      }
      .fortune-header {
        display: flex; justify-content: space-between; align-items: baseline;
        padding: 0.8mm; margin: 0.5mm;
        border-bottom: none !important;
      }
      .fortune-label { font-size: 11px; font-weight: bold; }
      .fortune-meter { font-size: 11px; letter-spacing: 1px; flex-shrink: 0; }
      .fortune-text {
        font-size: 10px;      
        line-height: 1.4; 
        padding: 0 1.5mm 1.5mm; margin: 0;
        overflow: hidden; 
        height: 25mm;         
      }
      
      .lucky-row { margin-top: 2mm; gap: 2mm; flex-shrink: 0; }
      .lucky-box {
        padding: 1mm; border-radius: 0;
        height: 15mm; 
        border: 1px solid white !important;
        background: none !important; 
        display: flex; flex-direction: column; justify-content: center; align-items: center;
      }
      .lucky-label { font-size: 8px; font-weight: bold; margin-bottom: 0.5mm; }
      .lucky-value { font-size: 11px; font-weight: 900; }
      #luckyItem { color: #dd571c !important; } 
      #luckyColor { color: #dd571c !important; }
      
      * { -webkit-print-color-adjust: exact !important; print-color-adjust: exact !important; color: black !important; }
    }
  </style>
</head>
<body>
  <div class="container">
    <header class="header">
      <div class="festival-name">ğŸª 2025å¹´ å¯Œå¡šå”åƒã‚»ãƒ³ã‚¿ãƒ¼ç¥­ã‚Š ğŸª</div>
      <h1 class="main-title">ãƒ‰ã‚­ãƒ‰ã‚­å ã„ãƒã‚·ãƒ¼ãƒ³</h1>
    </header>
    <main>
      <div class="input-card" id="inputSection">
        <div class="form-group">
          <label class="label" for="nameInput"><span class="emoji">ğŸ‘¤</span>ãªã¾ãˆ</label>
          <input type="text" id="nameInput" class="input-field" placeholder="ã•ã‚“ã•ã‚“ãƒ©ã‚¤ã‚ªãƒ³">
        </div>
        <div class="form-group">
          <label class="label" for="yearInput"><span class="emoji">ğŸ‚</span>ç”Ÿã¾ã‚ŒãŸå¹´</label>
          <input type="number" id="yearInput" class="input-field" min="1900" max="2100" placeholder="2015">
        </div>
        <div class="form-group">
          <label class="label"><span class="emoji">ğŸ“…</span>èª•ç”Ÿæ—¥ï¼ˆæœˆã¨æ—¥ï¼‰</label>
          <div class="date-row">
            <select id="monthInput" class="input-field"><option value="" hidden>æœˆ</option></select>
            <select id="dayInput" class="input-field"><option value="" hidden>æ—¥</option></select>
          </div>
        </div>
        <div class="form-group">
          <label class="label"><span class="emoji">ğŸ˜Š</span>ãã¿ã¯ã©ã£ã¡ï¼Ÿ</label>
          <div class="gender-selector">
            <input type="radio" name="gender" value="boy" id="gender-boy" checked>
            <label for="gender-boy"><span class="icon">â™‚ï¸</span><span class="text">ç”·ã®å­</span></label>
            <input type="radio" name="gender" value="girl" id="gender-girl">
            <label for="gender-girl"><span class="icon">â™€ï¸</span><span class="text">å¥³ã®å­</span></label>
            <input type="radio" name="gender" value="neutral" id="gender-neutral">
            <label for="gender-neutral"><span class="icon">â“</span><span class="text">ç­”ãˆãªã„</span></label>
          </div>
        </div>
        <div class="button-group">
          <button class="btn btn-primary" id="previewBtn">ğŸ‘€ å ã„çµæœã‚’è¦‹ã‚‹ï¼</button>
        </div>
      </div>
      <div class="preview-section" id="previewSection">
        <div class="preview-header"><div class="preview-title">ğŸ¯ å ã„çµæœ</div></div>
        <div class="screen-preview-wrapper">
          <div class="print-preview" id="printPreview">
            <div class="preview-head">
              <div class="preview-festival">ğŸª 2025å¹´ å¯Œå¡šå”åƒã‚»ãƒ³ã‚¿ãƒ¼ç¥­ã‚Š ğŸª</div>
              <h2 class="preview-main-title">ãƒ‰ã‚­ãƒ‰ã‚­å ã„ãƒã‚·ãƒ¼ãƒ³</h2>
              <div class="preview-score">
                <span id="previewNameText"></span>ã•ã‚“ã®é‹å‹¢ã¯â€¦ <span id="previewScore">â€•</span> ç‚¹
              </div>
            </div>
            <div class="fortune-grid">
              <div class="fortune-item">
                <div class="fortune-header">
                  <div class="fortune-label">ä»Šæ—¥ã®ãŠã¾ã¤ã‚Šé‹</div>
                  <div class="fortune-meter" id="meterStudy">â€•</div>
                </div>
                <div class="fortune-text" id="textStudy">â€•</div>
              </div>
              <div class="fortune-item">
                <div class="fortune-header">
                  <div class="fortune-label">ãŠã“ã¥ã‹ã„ã€ã”ã»ã†ã³é‹</div>
                  <div class="fortune-meter" id="meterMoney">â€•</div>
                </div>
                <div class="fortune-text" id="textMoney">â€•</div>
              </div>
              <div class="fortune-item">
                <div class="fortune-header">
                  <div class="fortune-label">ã¨ã‚‚ã ã¡ã€ã‚Œã‚“ã‚ã„é‹</div>
                  <div class="fortune-meter" id="meterLove">â€•</div>
                </div>
                <div class="fortune-text" id="textLove">â€•</div>
              </div>
            </div>
            <div class="lucky-row">
              <div class="lucky-box"><div class="lucky-label">ãƒ©ãƒƒã‚­ãƒ¼ã‚¢ã‚¤ãƒ†ãƒ </div><div class="lucky-value" id="luckyItem">â€•</div></div>
              <div class="lucky-box"><div class="lucky-label">ãƒ©ãƒƒã‚­ãƒ¼ã‚«ãƒ©ãƒ¼</div><div class="lucky-value" id="luckyColor">â€•</div></div>
            </div>
          </div>
          <div class="print-actions">
            <button class="btn btn-print" id="printBtn">ğŸ–¨ï¸ å°åˆ·ã™ã‚‹</button>
            <button class="btn btn-back" id="backBtn">â† æˆ»ã‚‹</button>
          </div>
        </div>
      </div>
    </main>
    <footer class="stats-bar">
      <div class="stats-text">ä»Šæ—¥ã®å ã„: <span id="printCount">0</span> äººç›®</div>
    </footer>
  </div>
  <script src="./fortunes-age-0-6.js"></script>
  <script src="./fortunes-age-7-9.js"></script>
  <script src="./fortunes-age-10-12.js"></script>
  <script src="./fortunes-age-13-17.js"></script>
  <script src="./fortunes-age-18-22.js"></script>
  <script src="./fortunes-age-23-29.js"></script>
  <script src="./fortunes-age-30-59.js"></script>
  <script src="./fortunes-age-60-plus.js"></script>
  <script src="./fortunes-parents.js"></script>
  <script src="./fortunes-teachers.js"></script>
  <script src="./special-fortunes.js"></script>
  <script src="./app.js"></script>
  <script>
    const monthSelect = document.getElementById('monthInput');
    const daySelect = document.getElementById('dayInput');
    for (let m = 1; m <= 12; m++) { const opt = document.createElement('option'); opt.value = String(m).padStart(2, '0'); opt.textContent = m + 'æœˆ'; monthSelect.appendChild(opt); }
    for (let d = 1; d <= 31; d++) { const opt = document.createElement('option'); opt.value = String(d).padStart(2, '0'); opt.textContent = d + 'æ—¥'; daySelect.appendChild(opt); }
    let printCounter = parseInt(localStorage.getItem('fortunePrintCount_v1') || '0');
    document.getElementById('printCount').textContent = printCounter;
    
    function meter(el, lv, on, off) {
      let text;
      if (lv > 5) {
        text = on.repeat(lv);
      } else {
        text = Array(5).fill(off).map((v, i) => i < lv ? on : v).join('');
      }
      el.textContent = text;
    }
    
    document.getElementById('previewBtn').addEventListener('click', () => {
      const name = document.getElementById('nameInput').value.trim();
      const year = document.getElementById('yearInput').value;
      const month = document.getElementById('monthInput').value;
      const day = document.getElementById('dayInput').value;
      const gender = document.querySelector('input[name="gender"]:checked').value;
      if (!name || !year || !month || !day) { alert('ã™ã¹ã¦ã®é …ç›®ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„'); return; }
      const res = window.FortuneEngine.run(name, +year, +month, +day, gender);
      if(!res) { alert("å ã„ãƒ‡ãƒ¼ã‚¿ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ã§ã—ãŸã€‚ãƒ‡ãƒ¼ã‚¿ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ç¢ºèªã—ã¦ãã ã•ã„ã€‚"); return; }
      document.getElementById('previewNameText').textContent = name;
      document.getElementById('previewScore').textContent = res.score;
      meter(document.getElementById('meterStudy'), res.study_lv, 'âœï¸', 'âšªï¸');
      meter(document.getElementById('meterMoney'), res.money_lv, 'ğŸ’°', 'âšªï¸');
      meter(document.getElementById('meterLove'), res.love_lv, 'â¤ï¸', 'âšªï¸');
      document.getElementById('textStudy').textContent = res.study_msg;
      document.getElementById('textMoney').textContent = res.money_msg;
      document.getElementById('textLove').textContent = res.love_msg;
      document.getElementById('luckyItem').textContent = res.luckyItem;
      document.getElementById('luckyColor').textContent = res.luckyColor;
      document.getElementById('inputSection').style.display = 'none';
      document.getElementById('previewSection').classList.add('show');
      window.scrollTo({ top: 0, behavior: 'smooth' });
    });
    document.getElementById('printBtn').addEventListener('click', () => {
      printCounter++;
      localStorage.setItem('fortunePrintCount_v1', printCounter);
      document.getElementById('printCount').textContent = printCounter;
      window.print();
    });
    document.getElementById('backBtn').addEventListener('click', () => {
      document.getElementById('previewSection').classList.remove('show');
      document.getElementById('inputSection').style.display = 'block';
      document.getElementById('nameInput').value = '';
      document.getElementById('nameInput').focus();
      window.scrollTo({ top: 0, behavior: 'smooth' });
    });
    document.getElementById('nameInput').focus();
  </script>

<!-- â˜…â˜…â˜… éš ã—ãƒ¢ãƒ¼ãƒ‰æ“ä½œç”¨ã®ã‚¹ã‚¯ãƒªãƒ—ãƒˆ â˜…â˜…â˜… -->
<script>
document.addEventListener('keydown', function(event) {
// ä¿®é£¾ã‚­ãƒ¼ãŒæŠ¼ã•ã‚Œã¦ã„ãªã„å ´åˆã¯ç„¡è¦–
if (!event.ctrlKey || !event.altKey) return;

// ã‚­ãƒ¼å…¥åŠ›ã«ã‚ˆã‚‹ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã®å‹•ä½œã‚’ã‚­ãƒ£ãƒ³ã‚»ãƒ«
event.preventDefault();

// Ctrl + Alt + H: é«˜ç¢ºç‡ãƒ¢ãƒ¼ãƒ‰
if (event.key === 'h') {
const currentMode = sessionStorage.getItem('probabilityVaryMode');
if (currentMode === 'true') {
sessionStorage.removeItem('probabilityVaryMode');
alert('é«˜ç¢ºç‡ãƒ¢ãƒ¼ãƒ‰ãŒç„¡åŠ¹ã«ãªã‚Šã¾ã—ãŸã€‚\nï¼ˆé€šå¸¸ãƒ¢ãƒ¼ãƒ‰ã®æŠ½é¸ã«æˆ»ã‚Šã¾ã—ãŸï¼‰');
} else {
sessionStorage.setItem('probabilityVaryMode', 'true');
alert('é«˜ç¢ºç‡ãƒ¢ãƒ¼ãƒ‰ãŒæœ‰åŠ¹ã«ãªã‚Šã¾ã—ãŸï¼\nï¼ˆå¤§å½“ãŸã‚Šã®ç¢ºç‡ãŒç´„30%ã«ãªã‚Šã¾ã™ï¼‰');
}
}
// Ctrl + Alt + P: ä¿è­·è€…ãƒ¢ãƒ¼ãƒ‰
else if (event.key === 'p') {
sessionStorage.removeItem('teacherMode'); // å…ˆç”Ÿãƒ¢ãƒ¼ãƒ‰ã‚’OFF
sessionStorage.setItem('parentMode', 'true');
alert('ã€ä¿è­·è€…ãƒ¢ãƒ¼ãƒ‰ã€‘ãŒæœ‰åŠ¹ã«ãªã‚Šã¾ã—ãŸã€‚\nï¼ˆä¿è­·è€…å‘ã‘ã®å ã„çµæœãŒè¡¨ç¤ºã•ã‚Œã¾ã™ï¼‰');
}
// Ctrl + Alt + T: å…ˆç”Ÿãƒ¢ãƒ¼ãƒ‰
else if (event.key === 't') {
sessionStorage.removeItem('parentMode'); // ä¿è­·è€…ãƒ¢ãƒ¼ãƒ‰ã‚’OFF
sessionStorage.setItem('teacherMode', 'true');
alert('ã€å…ˆç”Ÿãƒ¢ãƒ¼ãƒ‰ã€‘ãŒæœ‰åŠ¹ã«ãªã‚Šã¾ã—ãŸã€‚\nï¼ˆå…ˆç”Ÿå‘ã‘ã®å ã„çµæœãŒè¡¨ç¤ºã•ã‚Œã¾ã™ï¼‰');
}
// Ctrl + Alt + R: é€šå¸¸ãƒ¢ãƒ¼ãƒ‰ï¼ˆå…¨ãƒªã‚»ãƒƒãƒˆï¼‰
else if (event.key === 'r') {
sessionStorage.removeItem('probabilityVaryMode');
sessionStorage.removeItem('parentMode');
sessionStorage.removeItem('teacherMode');
alert('å…¨ã¦ã®ç‰¹åˆ¥ãƒ¢ãƒ¼ãƒ‰ã‚’ãƒªã‚»ãƒƒãƒˆã—ã€é€šå¸¸ãƒ¢ãƒ¼ãƒ‰ã€‘ã«æˆ»ã‚Šã¾ã—ãŸã€‚');
}
});
</script>

</body>
</html>